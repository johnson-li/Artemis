"use strict";window.wafer&&window.wafer.ready(function(){window.wafer.on("fetch:success",function(e){var t,a=e.elem;a.classList&&a.classList.contains("stream-batch-fetch")&&((t=window.rapidPageConfig&&window.rapidPageConfig.rapidConfig&&window.rapidPageConfig.rapidConfig.spaceid)&&(window._comscore=window._comscore||[],window._comscore.push({c1:2,c2:"7241469",c5:t,c7:document.location.href,c14:window.YAHOO&&window.YAHOO.comscore&&window.YAHOO.comscore.c14||-1}),window.COMSCORE&&window.COMSCORE.purge()))});var e,t,a,n,w="show-drawer",m=null,f=null,g=null,h="stream-uuid-list",c="userintent-disliked-anim",l="data-uuid",i="youmaylike",y=[],u=document.querySelector(".stream-items"),s=document.querySelector(".stream-ad-fetch"),d=window.innerWidth||document.documentElement.clientWidth,r="js-sponsored-moments-dwell-time",p="userintent-show-reason",v={};u&&(u.addEventListener("animationend",function(e){var t=e&&e.target;e&&t&&("hideStreamItem"===e.animationName||"fadeOutAdConfirm"===e.animationName)&&t.parentNode&&!t.classList.contains("ad-feedback-options")&&(window.wafer.base.destroy(t),t.parentNode.removeChild(t))}),u.addEventListener("click",function(e){var t,a,n,i=e.target;i.classList.contains("userintent-undo")&&(t=i.getAttribute("data-wf-toggle-target"),!(a=u.querySelector(t))||(n=a.getAttribute(l))&&v[n]&&clearTimeout(v[n]))}),s&&window.wafer.base&&window.wafer.utils&&(e=s.getAttribute("data-wf-url"),t=s.getAttribute("data-wf-state-body"),window.wafer.utils.fetchWithCache(e,{body:t,cache:0}).then(function(e){if(e&&e.html){s.innerHTML=e.html;var t=s.querySelectorAll(".stream-ad"),a=u.querySelectorAll(".stream-ad-placeholder");if(t&&a)for(var n=t.length,i=a.length,r=0;r<i&&r<n;r++)a[r].replaceWith(t[r]);s.innerHTML="",window.wafer.base.sync(u)}})),(a=u.querySelectorAll("."+r+", ."+r+"-mon")).length&&(a.forEach(function(e){e.classList&&e.classList.contains("js-reserve-moments")&&(window.DARLA?function e(t){var a,n,i,r=Math.floor(16*d/9),s=t.querySelector("#defaultRESERVEMOMENTS"),o=s&&s.getAttribute("data-html");o&&(a=window.DARLA.prefetched(),window.DARLA.inProgress()||a&&0!==a.length?setTimeout(function(){e(t)},500):(n={dest:"defaultRESERVEMOMENTS",flex:{h:{min:r},w:{min:d}},h:r,id:"RESERVEMOMENTS",supports:{"exp-ovr":1,"exp-push":1,"resize-to":1},w:d},window.DARLA.addPos(n),i=new window.DARLA.Response("RESERVEMOMENTS",{}),o=unescape(o),i.add("RESERVEMOMENTS",o),window.DARLA.render(i)))}(e):e.style.display="none")}),(n=a[0].querySelector(".js-panorama-scroll-view"))&&0===n.scrollLeft&&(n.scrollLeft=(n.scrollWidth-d)/2)));window.addEventListener("viewerOpened",function(e){var t=e&&e.detail&&e.detail.uuid;if(t){var a=document.querySelector('li[data-uuid="'+t+'"]'),n=a&&a.getAttribute("data-parent-uuid");if(m=n&&document.querySelector('li[data-uuid="'+n+'"]')||a,g=m&&m.getElementsByClassName("stream-related-drawer")[0]){if(m.classList.contains(w))return;var i={config:{relatedUuid:t},ctrl:"StreamRelated",m_id:"tdv2-wafer-stream",m_mode:"json"},r={dedupeUUIDs:function(){for(var e=Array.prototype.slice.call(document.getElementsByClassName(h)),t=0;t<e.length;t++){var a=e[t],n=a.text;a.classList.remove(h);try{var i=JSON.parse(n);i&&Array.isArray(i.uuidList)&&y.length+i.uuidList.length<=250&&(y=y.concat(i.uuidList))}catch(e){}}return{dedupeUUIDs:y}}().dedupeUUIDs.join(","),uuid:t},s=g.getAttribute("data-cfg");if(s)try{var o=JSON.parse(s);o&&o.i13n&&(f=o.i13n),i.config=Object.assign(i.config,o)}catch(e){}var d=g.getAttribute("data-bucket");d&&(i.bucket=d),i.config.tachyonParams=i.config.tachyonParams||{},i.config.tachyonParams.query=i.config.tachyonParams.query||{},i.config.tachyonParams.query.where=Object.assign(r,i.config.tachyonParams.query.where);var c,l=window.wafer.base.state.drawer,u=l&&l.adsToken;u&&(c={query:{where:{ads_dedup_token:u}}},i.config.adTachyonParams=Object.assign(i.config.adTachyonParams||{},c)),g.setAttribute("data-wf-body",JSON.stringify(i)),g.classList.remove("wafer-fetch-error","wafer-fetch-complete"),g.classList.add("wafer-fetch"),window.wafer.base.sync(g.parentNode)}}}),window.addEventListener("viewerClosed",function(){var e;m&&!m.classList.contains(w)&&((e=g&&!!g.getElementsByClassName("stream-realted-list")[0])&&m.classList.add(w),e&&f&&window.rapidInstance&&window.rapidInstance.beaconClick("strm",i,0,Object.assign(f,{_p:0,cnt_tpc:f.categoryLabel,g:m.getAttribute(l),grpt:"storyCluster",itc:1,pkgt:i})),f="",m=g=null)});window.wafer.on("toggle:change",function(e){if(e&&e.meta&&e.elem){var t,a,n=e.elem,i=n.getAttribute("data-wf-toggle-target");if("userintent-hidestrmitem"===e.meta.className&&"add"===e.meta.action)i&&u&&((a=(t=u.querySelector(i))&&t.getAttribute(l))&&(v[a]=setTimeout((d=t,function(){d.classList.contains(c)||d.classList.add(c)}),8e3)));else if("show-drawer"===e.meta.className){var r=u.querySelector(i),s=r&&r.getElementsByClassName("drawer-fetch-target")[0];setTimeout(function(){s&&(s.innerHTML="")},300)}else if("userintent-show"===e.meta.className&&n){var o=window.wafer.utils.findAncestor(n,"stream-item");if(!o)return;"add"===e.meta.action?(o.classList.add(p),window.rapidInstance&&window.rapidInstance.reevaluateModulesViewability(o)):"remove"===e.meta.action&&o.classList.remove(p)}}var d})});