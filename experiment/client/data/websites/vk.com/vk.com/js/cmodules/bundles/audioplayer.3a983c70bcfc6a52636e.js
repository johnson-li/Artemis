(window.webpackJsonp=window.webpackJsonp||[]).push([["bundles/audioplayer"],{"4bNW":function(__webpack_module__,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"onRowOver",(function(){return onRowOver}));var core_js_modules_es6_array_from__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("HEwt"),core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("a1Th"),core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("Btvt"),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("rGqo"),core_js_modules_es7_symbol_async_iterator__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("rE2o"),core_js_modules_es6_symbol__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("ioFf"),_lib_dom__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("zxIV"),_lib_dom_events__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("Egk5");function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(i):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,a=new Array(e);i<e;i++)a[i]=t[i];return a}function _iterableToArrayLimit(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var i=[],a=!0,s=!1,o=void 0;try{for(var l,r=t[Symbol.iterator]();!(a=(l=r.next()).done)&&(i.push(l.value),!e||i.length!==e);a=!0);}catch(t){s=!0,o=t}finally{try{a||null==r.return||r.return()}finally{if(s)throw o}}return i}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function onRowOver(audioEl,event,forceRedraw){Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.hasClass)(audioEl,"podcast_list_snippet")||Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.hasClass)(audioEl,"podcast_snippet__controls")||(Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.data)(audioEl,"leaved",!1),Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.data)(audioEl,"actions")&&!forceRedraw||Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.hasClass)(audioEl,"no_extra")||(clearTimeout(window.audioRowHoverTO),window.audioRowHoverTO=setTimeout(()=>{window.tooltips&&"function"==typeof window.tooltips.hideAll&&window.tooltips.hideAll(audioEl);var audio=AudioUtils.getAudioFromEl(audioEl),audioObject=AudioUtils.getAudioFromEl(audioEl,!0),actions=[],moreActions=[],context=AudioUtils.getContextPlaylist(audioEl,!0),_AudioUtils$contextSp=AudioUtils.contextSplit(context),_AudioUtils$contextSp2=_slicedToArray(_AudioUtils$contextSp,2),sectionContext=_AudioUtils$contextSp2[0],blockContext=_AudioUtils$contextSp2[1],extra=AudioUtils.getAudioExtra(audioObject);if(context=sectionContext,audioObject.isDeleted)if(AudioUtils.isPodcast(audioObject))actions.push(["add",AudioUtils.restoreEpisode,"",'onmouseover="audioShowActionTooltip(this)"']);else if("recoms_recoms"===context)actions.push(["restore_recoms",AudioUtils.addAudio,"",'onmouseover="audioShowActionTooltip(this)"']);else{var deleteRestoreInfo=AudioUtils.getAddRestoreInfo();deleteRestoreInfo[audioObject.fullId]&&deleteRestoreInfo[audioObject.fullId].deleteAll&&actions.push(["delete",AudioUtils.deleteAudio,"",'onmouseover="audioShowActionTooltip(this)"']),actions.push(["add",AudioUtils.addAudio,"",'onmouseover="audioShowActionTooltip(this)"'])}else{var actionsList=["next","add","share","open_album","add_to_playlist"];if(extra.claim&&nav.objLoc.claim||audioObject.isReplaceable)actionsList=[];else if(AudioUtils.isPodcast(audioObject))actionsList=Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.hasClass)(audioEl,"audio_podcast_no_actions")?[]:["fave","edit","delete","open_episode","share"];else if(audioObject.isFromCurrentPlaylist)actionsList=["recoms","add",!audioObject.isCurrent&&"current_delete","share","open_album","add_to_playlist"];else if(audioObject.isInSnippet)actionsList=["recoms","next","edit","add","share","open_album","add_to_playlist"];else if(audioObject.isInEditBox)actionsList=[];else if(audioObject.isInFastChat)actionsList=["add"];else if(vk.widget)actionsList=["add"];else if(context)switch(context){case"album_page":actionsList=["recoms","next","edit","add","share","open_album","add_to_playlist"];break;case"my":case"module":case"user_list":case"group_list":actionsList=["recoms","edit","next","add","delete","share","open_album","add_to_playlist"];break;case"edit_playlist":actionsList=["add","next","edit"];break;case"recoms_recoms":actionsList=["recoms","next","add","recoms_delete","share","open_album","add_to_playlist"];break;case"recoms_recent_audios":actionsList=["recoms","edit","next","add","listened_delete","share","open_album","add_to_playlist"];break;case"attach":case"attach_preview":case"podcast":actionsList=[];break;case"search_results":"search_owned_audios"===blockContext&&(actionsList=["recoms","edit","next","add","delete","share","open_album","add_to_playlist"]);break;case"recommendations":"recoms_recoms_detail"===blockContext&&(actionsList=["recoms","next","add","recoms_delete","share","open_album","add_to_playlist"]);break;default:audioObject.isCurrent&&audioObject.withInlinePlayer&&(actionsList=["recoms","add","share","open_album","add_to_playlist"])}("moderation_video"===context||window.AdminVideoCatalogue)&&(actionsList=["link_to_clip"]),actionsList.push("uma"),audioObject.isReplaceable&&actionsList.push("replace"),extra.moder_actions&&each(extra.moder_actions,(i,act)=>{moreActions.push(["moder_"+i,(audioEl,audio)=>{eval(act[1])},act[2]])}),audioObject.isCurrentAlbumSnippet&&(actionsList=actionsList.filter(t=>"open_album"!==t)),vk.id||(actionsList=actionsList.filter(t=>"open_album"===t));var ap=getAudioPlayer(),currentAudioPage=window.currentAudioPage&&window.currentAudioPage(audioEl),isInLayer=currentAudioPage&&currentAudioPage.isLayer(),shouldShowEdit=!isInLayer&&audioObject.canEdit&&!vk.widget&&(AudioUtils.isPodcast(audioObject)||inArray(context,["my","group_list","search_owned_audios","my_playlists"]));each(actionsList,(t,e)=>{switch(e){case"link_to_clip":audioObject.isUMA&&actions.push(["link",window.AdminVideoCatalogue.processAudioInShortVideo,"LINK"]);break;case"next":audioObject.isCurrent||audioObject.isClaimed||AudioUtils.isPodcast(audioObject)||actions.push(["next",ap.setNext.bind(ap),"",'onmouseover="audioShowActionTooltip(this)"']);break;case"restore_recoms":actions.push(["restore_recoms",AudioUtils.addAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"add":var i=vk.id;cur.audioPage&&cur.audioPage.canAddToGroup()&&cur.audioPage.getOwnerId()!==audioObject.ownerId&&(i=cur.audioPage.getOwnerId()),!audioObject.isClaimed&&audioObject.canAdd&&audioObject.ownerId!=i&&actions.push(["add",AudioUtils.addAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"recoms":!audioObject.isClaimed&&cur.audioPage&&actions.push(["recoms",AudioUtils.showRecoms,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"uma":audioObject.isUMA&&actions.push(["uma",AudioUtils.getUMAInfo,"UMA"]);break;case"replace":audioObject.isReplaceable&&actions.push(["replace",()=>{showAudioClaimWarning(audioObject,extra.claim,AudioUtils.replaceWithOriginal.bind(AudioUtils,audioEl,audioObject))},getLang("global_audio_replace")]);break;case"edit":shouldShowEdit&&actions.push(["edit",AudioUtils.isPodcast(audioObject)?AudioUtils.editEpisode:AudioUtils.editAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"delete":!audioObject.canDelete||audioObject.isInRecomsBlock||vk.widget||actions.push(["delete",AudioUtils.isPodcast(audioObject)?AudioUtils.deleteEpisode:AudioUtils.deleteAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"current_delete":actions.push(["current_delete",AudioUtils.deleteCurrentAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"recoms_delete":actions.push(["recoms_delete",AudioUtils.deleteRecomsAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"listened_delete":audioObject.isInRecomsBlock||actions.push(["listened_delete",AudioUtils.deleteListenedAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"fave":AudioUtils.isPodcast(audioObject)&&actions.push(["fave",AudioUtils.faveEpisode,"",'onmouseover="audioShowActionTooltip(this)"',AudioUtils.getAudioExtra(audioObject).fave?" activated":""]);break;case"share":audioObject.isClaimed||moreActions.push(["share",AudioUtils.shareAudio,getLang("audio_share_audio")]);break;case"add_to_playlist":audioObject.isClaimed||cur.viewAsBox||moreActions.push(["add_to_playlist","",getLang("audio_add_to_playlist")]);break;case"open_album":!audioObject.isClaimed&&audioObject.album&&moreActions.push(["open_album",AudioUtils.showAudioAlbum,getLang("audio_open_album")]);break;case"open_episode":AudioUtils.isPodcast(audioObject)&&moreActions.push(["open_episode",AudioUtils.openEpisode,getLang("audio_podcast_open_episode")])}}),extra.claim&&nav.objLoc.claim&&(audioObject.isSetClaimed?actions.push(["claim_btn",AudioUtils.unclaim.bind(this,audio,audioEl,extra.claim),"Unclaim"]):actions.push(["claim_btn",AudioUtils.claim.bind(this,audio,audioEl,extra.claim),"Claim"]))}if(moreActions.length&&actions.push(["more"]),actions.length){var actionsEl=Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.se)('<div class="_audio_row__actions audio_row__actions"></div>');each(actions,(t,e)=>{var i=AudioUtils.getRowActionName(e[0],audioObject,audioEl),a=Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.se)(`<button aria-label="${i}" data-action="${e[0]}" class="audio_row__action audio_row__action_${e[0]} _audio_row__action_${e[0]}${e[4]?" "+e[4]:""}" ${e[3]||""}>${e[2]||""}</button>`);e[1]&&a.addEventListener("click",t=>(e[1]&&e[1].call(window,audioEl,audioObject),Object(_lib_dom_events__WEBPACK_IMPORTED_MODULE_7__.cancelEvent)(t))),actionsEl.appendChild(a)});var audioRestorationInfo=AudioUtils.getAddRestoreInfo()[audioObject.fullId];audioRestorationInfo&&"added"===audioRestorationInfo.state&&addClass(audioEl,"audio_row__added");var rowInfoEl=Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.geByClass1)("_audio_row__info",audioEl),rowDurationEl=Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.geByClass1)("_audio_row__duration",audioEl),rowAlreadyActionsEl=Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.geByClass1)("_audio_row__actions",audioEl);if(!rowInfoEl)return;Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.re)(rowAlreadyActionsEl),Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.setStyle)(rowDurationEl,"visibility","hidden"),rowInfoEl.appendChild(actionsEl);var moreActionsBtnEl=Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.geByClass1)("_audio_row__action_more",actionsEl);moreActions.length&&moreActionsBtnEl&&setMoreAction(audioEl,audio,audioObject,moreActions,moreActionsBtnEl),Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.data)(audioEl,"actions",1)}},forceRedraw?0:10)))}function setMoreAction(t,e,i,a,s){var o=gpeByClass("im-page_classic",t),l=gpeByClass("_im_peer_history_w",t),r=gpeByClass("_im_peer_history",t),d=gpeByClass("_im_chat_body_abs",t),n=Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.se)('<div class="_audio_row__more_actions audio_row__more_actions"></div>'),u=gpeByClass("wk_history_audio_content",t),_={};r?(_.getWrapEl=()=>o?null:d,_.appendTo=r):u?_.appendTo=u:gpeByClass(".post",t)?_.appendTo=document.body:_.appendToParent=!0;var c=new ElementTooltip(s,extend({cls:"_audio_row__tt",defaultSide:"bottom",rightShift:20,content:n,bottomGap:o&&l?parseInt(getStyle(l,"border-bottom-width"))+30+150:150,preventSideChange:!0,autoShow:!0,onFirstTimeShow:function(t,e){Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.domData)(e,"nodrag",1),setTimeout(function(){this.getOptions().bottomGap=0}.bind(this))},onHide:()=>{Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.data)(t,"leaved")&&AudioUtils.onRowLeave(t)}},_));each(a,(a,s)=>{var o=Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.se)(Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.rs)(AudioUtils.AUDIO_ROW_ACTION_ROW_ITEM,s));switch(s[0]){case"add_to_playlist":var l,r;o.addEventListener("mouseenter",l=()=>{clearTimeout(r),r=setTimeout(()=>{o.removeEventListener("mouseenter",l),AudioUtils.initRowPlaylistsChooser(e,o,c)},150)}),o.addEventListener("click",()=>{r||AudioUtils.initRowPlaylistsChooser(e,o,c)}),o.addEventListener("mouseleave",()=>{clearTimeout(r)});break;default:o.addEventListener("click",e=>(s[1].call(window,t,i),Object(_lib_dom_events__WEBPACK_IMPORTED_MODULE_7__.cancelEvent)(e)))}n.appendChild(o)}),addEvent(s,"click",t=>{c.isShown()||c.show(),Object(_lib_dom_events__WEBPACK_IMPORTED_MODULE_7__.cancelEvent)(t)}),Object(_lib_dom__WEBPACK_IMPORTED_MODULE_6__.data)(t,"tt",c)}},"4e3S":function(__webpack_module__,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return AudioLayer}));var _lib_debug_tools__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("98sY");class AudioLayer{static prepare(t){stManager.add([jsc("web/audio.js"),"audio.css",jsc("web/suggester.js"),jsc("web/auto_list.js"),jsc("web/indexer.js")],()=>{t&&t()})}constructor(){this._els={layerPlace:ge("top_audio_layer_place"),topPlayBtn:geByClass1("_top_audio_player_play"),topNotaBtn:geByClass1("_top_nav_audio_btn"),topNotaBtnGroup:ge("top_audio_btn_group")}}toggle(t,e){this._initTooltip();var i=this._els.tooltip,a=void 0!==t?t:!i.isShown();a?(i.show(),cancelStackPush("top_audio",()=>{this.toggle(!1,!0)},!0)):(e||cancelStackPop(),i.hide()),toggleClass(this._els.topNotaBtn,"active",a)}hide(){this._els.tooltip.hide()}isShown(){return this._els.tooltip&&this._els.tooltip.isShown()}updatePosition(){return this._els.tooltip&&this._els.tooltip.updatePosition()}_layerPosition(){var t=getXY(this._els.layerPlace),e=getXY("ts_wrap")[0]-t[0]-1,i=0;isVisible(this._els.topNotaBtnGroup)?i=-e+(getXY(this._els.topNotaBtn)[0]-t[0])+15:i=-e+(getXY(this._els.topPlayBtn)[0]-t[0])+3;return{left:e,top:0,arrowPosition:i}}getPageInstance(){return this._page}getTemplate(){return`\n      <div class="audio_layer_container">\n        <div class="top_audio_loading">\n          ${rs(vk.pr_tpl,{id:"",cls:"pr_big"})}\n        </div>\n      </div>\n    `}_initTooltip(){this._els.tooltip||(this._els.container=se(this.getTemplate()),this._els.tooltip=new ElementTooltip(this._els.layerPlace,{id:"audio_layer_tt",content:this._els.container,width:660,offset:[22,5],autoShow:!1,customShow:!0,setPos:this._layerPosition.bind(this),forceSide:"bottom",onHide:()=>{this._page&&this._page.onLayerHide()},onShow:()=>{this._page&&this._page.onLayerShow(this._initSection)}}),ajax.post("al_audio.php",{act:"layer",is_layer:1,is_current_playlist:ap.getCurrentPlaylist()?1:0},{onDone:(html,data,templatesScript)=>{try{eval(templatesScript)}catch(t){Object(_lib_debug_tools__WEBPACK_IMPORTED_MODULE_0__.logEvalError)(t,templatesScript)}this._els.container.innerHTML=html,this._page=new AudioPage(geByClass1("_audio_page_layout",this._els.container),data),this._initSection="recoms"==data.initSection?data.initSection:void 0,this._page.onLayerShow(this._initSection)},onFail:()=>!0}))}}},"5xrp":function(t,e,i){"use strict";i.r(e),i.d(e,"onAdditionalEvent",(function(){return u}));i("91GP");var a=i("6ng+"),s=i("fY4C"),o=i("/PiP"),l=i("lXup"),r=i("pOqz");function d(t){var e,i=window.currentAudioPage&&window.currentAudioPage(t),a=i&&i.getPageCurrentPlaylist(),s=Object(l.getContextPlaylist)(t,!0);return s&&(s=Object(r.contextSplit)(s),Array.isArray(s)&&s.length>0&&(e=s[0])),("search"===e&&a&&a.getSearchQid()||"search"===window.cur.module&&window.cur.qid)&&(e="search:external"),e}function n(){return(n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(t[a]=i[a])}return t}).apply(this,arguments)}function u(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},l=new a.AudioStats(new s.WebPlayerAdapter(Object(o.getAudioPlayer)())),r=e&&e.context||t&&d(t)||"",u=e&&e.album&&e.album.slice(0,2).join("_"),_=n({},e,{context:r,playlistId:u},i);l.sendCurrentAudioEvent({type:_.type,subtype:_.subtype||l.getPlaySubtype(),ownerId:_.ownerId,audioId:_.id,trackCode:_.trackCode,state:l.playerAdapter.getState(),ref:window.cur&&vk.widget?String(cur.widgetReferrer||"").substring(0,20):"",context:_.context,playlistId:_.playlistId})}},B3ia:function(t,e,i){"use strict";i.r(e),i.d(e,"init",(function(){return at}));var a=i("4e3S"),s=i("pp2G"),o=i("zxIV"),l=i("rEJs"),r="top_audio_player_enabled";class d{constructor(t){this.ap=getAudioPlayer(),this._el=t,this._playIconBtn=Object(o.ge)("top_audio"),this._audioBtnGroup=Object(o.ge)("top_audio_btn_group"),this.init()}static init(){var t=Object(o.ge)("top_audio_player"),e=Object(o.data)(t,"object");e||(e=new d(t),Object(o.data)(t,"object",e))}init(){var t=this;function e(e){return Object(o.hasClass)(this,"top_audio_player_play")?(t.ap.podcastSetActionRef(t.ap.getCurrentAudio(),t.ap.isPlaying()?s.AudioUtils.PodcastsLogs.ACTION_PAUSE:s.AudioUtils.PodcastsLogs.ACTION_PLAY,"top_player"),t.ap.isPlaying()?t.ap.pause():t.ap.play(),!1):Object(o.hasClass)(this,"top_audio_player_prev")?(t.ap.playPrev(),!1):Object(o.hasClass)(this,"top_audio_player_next")?(t.ap.playNext(),!1):void 0}this.ap.on(this,l.events.UPDATE,this.onUpdate.bind(this)),this.ap.on(this,l.events.PLAY,this.onPlay.bind(this)),this.ap.on(this,l.events.PLAY_REQUESTED,this.onPlay.bind(this)),this.ap.on(this,[l.events.PAUSE,l.events.STOP],this.onPause.bind(this)),this.ap.top=this,each(["prev","play","next"],(function(i,a){addEvent(Object(o.geByClass1)("top_audio_player_"+a,t._el),"click",e)})),addEvent(this._el,"mousedown",(function(t){if(!Object(o.hasClass)(Object(o.domPN)(t.target),"top_audio_player_btn"))return 1!=t.which||Object(o.hasClass)(t.target,"top_audio_player_btn")||Object(o.hasClass)(t.target,"top_audio_player_act_icon")||s.AudioUtils.getLayer().toggle(),cancelEvent(t)})),addEvent(Object(o.ge)("top_audio"),"mousedown",(function(t){return!0!==checkEvent(t)&&(s.AudioUtils.getLayer().toggle(),cancelEvent(t))})),browser.safari||addEvent(document,"keydown keyup",(function(t){Object(o.toggleClass)(Object(o.ge)("top_audio_play"),"shuffle",t.shiftKey)})),this._resetAudio(),this._updateTitle(this.ap.getCurrentAudio())}onPause(){Object(o.removeClass)(this._el,"top_audio_player_playing");var t=Object(o.geByClass1)("_top_audio_player_play_blind_label");t&&(t.innerHTML=getLang("global_audio_play"))}onPlay(t,e,i){this._hideButton(),requestAnimationFrame((function(){var t=s.AudioUtils.getLayer();t&&t.isShown()&&t.updatePosition()})),Object(o.addClass)(this._el,r),Object(o.toggleClass)(this._el,"top_audio_player_playing",!0);var a=Object(o.geByClass1)("_top_audio_player_play_blind_label");a&&(a.innerHTML=this.ap.isPlaying()?getLang("global_audio_pause"):getLang("global_audio_play")),this._updateTitle(t,i)}onUpdate(t){t?(this._updateTitle(t),this._hideButton(),Object(o.addClass)(this._el,r)):this._resetAudio()}_updateTitle(t,e){if(e=intval(e),t=s.AudioUtils.asObject(t),Object(o.toggleClass)(this._el,"audio_player_podcast",s.AudioUtils.isPodcast(t)),t){void 0!==this._currTitleReTO&&clearTimeout(this._currTitleReTO);var i=Object(o.geByClass1)("top_audio_player_title_out",this._el);Object(o.re)(i);var a=Object(o.geByClass1)("top_audio_player_title",this._el);if(0!==e){var l=e<0?-10:10,r=`opacity: 0; top: ${l}px; left: ${a.offsetLeft}px`,n=t.performer+" &ndash; "+t.title,u=Object(o.se)('<div class="top_audio_player_title top_audio_player_title_next" style="'+r+'">'+n+"</div>");u.setAttribute("onmouseover","setTitle(this)"),e>0?domInsertAfter(u,a):domInsertBefore(u,a),Object(o.addClass)(a,"top_audio_player_title_out"),Object(o.setStyle)(a,{top:-l,opacity:0}),setTimeout((function(){Object(o.setStyle)(u,{top:0,opacity:1})}),10),clearTimeout(this._currTitleReTO),this._currTitleReTO=setTimeout((function(){Object(o.re)(a),Object(o.removeClass)(u,"top_audio_player_title_next")}),d.TITLE_CHANGE_ANIM_SPEED)}else a&&(a.innerHTML=t.performer+" &ndash; "+t.title,a.titleSet=0,a.setAttribute("onmouseover","setTitle(this)"))}}_resetAudio(){Object(o.removeClass)(this._playIconBtn,r),Object(o.removeClass)(this._el,r),Object(o.removeClass)(this._el,"top_audio_player_playing"),Object(o.removeClass)(this._el,"audio_player_podcast"),Object(o.show)(this._audioBtnGroup);var t=Object(o.geByClass1)("top_audio_play__button",this._audioBtnGroup);t&&Object(o.removeClass)(t,"loading");var e=s.AudioUtils.getLayer();e&&e.isShown()&&e.updatePosition()}_hideButton(){Object(o.hide)(this._audioBtnGroup),Object(o.hasClass)(this._playIconBtn,r)||Object(o.addClass)(this._playIconBtn,r)}}d.TITLE_CHANGE_ANIM_SPEED=190;var n,u=i("D33C"),_=(i("HEwt"),i("a1Th"),i("rGqo"),i("rE2o"),i("ioFf"),i("OEbY"),i("VRzm"),i("Btvt"),i("KKXr"),i("fY4C")),c=i("6ng+"),h=i("Emh1"),p=i("YvCB"),g=i("XBHu"),A=i("xk4V"),y=i("YQfe"),f=i("EW7Y"),v=i("C13D"),P=i("tGJf"),b=(i("pIFo"),i("nAFc")),m=i("DM2o"),E=i("QChX"),O=i("W0fz");function I(){n&&!n.getCurrentAudio()&&Object(E.clear)()}function w(){if(E.HAS_MEDIA_SESSION){var t=n.getCurrentPlaylist(),e=n.getCurrentAudio(),i=Object(v.asObject)(e);if(i){var a=Object(b.decodeHTMLEntities)(i.title+(i.subTitle?` (${i.subTitle})`:"")).replace(/<[^>]*>?/gm,""),s=Object(b.decodeHTMLEntities)(i.performer||"").replace(/<[^>]*>?/gm,""),o=Object(b.decodeHTMLEntities)(t&&t.getTitle&&t.getTitle()||"").replace(/<[^>]*>?/gm,""),l=i.coverUrl_p||i.coverUrl_s,r=l?[{sizes:"160x160",src:l}]:[];!function(){if(!E.HAS_MEDIA_SESSION)return;if(n.ads.isPlaying())navigator.mediaSession.setActionHandler("play",C),navigator.mediaSession.setActionHandler("pause",U),navigator.mediaSession.setActionHandler("seekbackward",null),navigator.mediaSession.setActionHandler("seekforward",null),navigator.mediaSession.setActionHandler("previoustrack",null),navigator.mediaSession.setActionHandler("nexttrack",null);else{navigator.mediaSession.setActionHandler("play",C),navigator.mediaSession.setActionHandler("pause",U);var t=n.getCurrentPlaylist(),e=n.getCurrentAudio();if(t&&t.isLive()?(navigator.mediaSession.setActionHandler("seekbackward",null),navigator.mediaSession.setActionHandler("seekforward",null)):(navigator.mediaSession.setActionHandler("seekbackward",T),navigator.mediaSession.setActionHandler("seekforward",L)),t&&!Object(O.isPodcast)(e)){var i=t.indexOfAudio(e),a=t.getAudioAt(i-1),s=t.getAudioAt(i+1);a?navigator.mediaSession.setActionHandler("previoustrack",S):navigator.mediaSession.setActionHandler("previoustrack",null),s?navigator.mediaSession.setActionHandler("nexttrack",D):navigator.mediaSession.setActionHandler("nexttrack",null)}else navigator.mediaSession.setActionHandler("previoustrack",null),navigator.mediaSession.setActionHandler("nexttrack",null)}}(),Object(E.updateMediaSessionMetadata)({title:a,artist:s,album:o,artwork:r})}}}function C(){n.play(),Object(m.statlogsValueEvent)("global_media_controls","audio_player","play")}function U(){n.pause(),Object(m.statlogsValueEvent)("global_media_controls","audio_player","pause")}function T(){var t=Object(v.asObject)(n.getCurrentAudio()),e=n.getCurrentProgress()*t.duration,i=Math.max(0,(e-10)/t.duration);i>0?n.seek(i):n.playPrev(),Object(m.statlogsValueEvent)("global_media_controls","audio_player","seek_backward")}function L(){var t=Object(v.asObject)(n.getCurrentAudio()),e=n.getCurrentProgress()*t.duration,i=Math.min(1,(e+10)/t.duration);i<1?n.seek(i):n.playNext(),Object(m.statlogsValueEvent)("global_media_controls","audio_player","seek_forward")}function S(){n.playPrev(),Object(m.statlogsValueEvent)("global_media_controls","audio_player","previous_track")}function D(){n.playNext(),Object(m.statlogsValueEvent)("global_media_controls","audio_player","next_track")}var j,x=i("wNya"),R=i("/0DE"),k=(j=function(t,e){return(j=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}j(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),M=function(t){function e(e){return t.call(this,e)||this}return k(e,t),e.prototype.connect=function(t){var e=this;t&&this.listenQueueKey!==t.key&&(this.connected=!0,this.listenQueueKey=t.key,window.Notifier.addKey({key:t.key,ts:t.timestamp},(function(t,i){return e.queueHandler(i)})))},e}(R.QueueListener),B=i("8zW9"),N=i("W9Tc"),H=null,F=null,W=!1,Y=0,K=new M((function(t){if(t.failed)return void V(!0);for(var e=getAudioPlayer(),i=e.isPlaying(),a=e.getCurrentAudio(),s=AudioUtils.isPodcast(a),o=0;o<t.events.length;o++){var l=t.events[o].data;if("start"===l.type&&AudioPlayer.getDeviceId()!==l.uuid&&!F&&!s&&i){e.pausedByQueue=Date.now(),e.pause(),F=showBox("al_audio.php",{act:"start_playback_box",uuid:l.uuid,device_name:l.device_name},{params:{hideButtons:!0,onHide:()=>{F=!1}},containerClass:"audio_playback_box"});break}}})),X=new M((function(t){t.events.length&&t.events.forEach(t=>{1===t.data.product_id&&(vk.audioAdsConfig.enabled=!t.data.active)})}));function V(t){if(window.Notifier&&vk.id){var e=window.ap&&getAudioPlayer(),i=e&&e.getCurrentAudio(),a=window.Notifier&&!vk.widget,s=!W&&i?K.listenQueueKey:X.listenQueueKey,o=AudioUtils.isPodcast(i);(t||a&&!o&&!s)&&(i||Object(N.partConfigEnabled)("audio_subscription_update"))&&function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!0;ajax.post("al_audio.php",{act:"queue_params",audio_id:t.id,owner_id:t.owner_id,hash:t.actionHash},{onDone:e,onFail:i})}(i=i?AudioUtils.asObject(i):{},t=>{var e=function(t){var e=Object(B.unpackQueues)(t);e.audio&&K.connect(e.audio);e.subscription&&X.connect(e.subscription);return e}(t);W=!i||!e.audio,(e.audio||e.subscription)&&(H&&clearTimeout(H),H=window.setTimeout(()=>V(!0),3e4))},()=>(++Y<3&&V(!0),!0))}}var G=i("DM26"),q=i("OOHW"),$=i("tWcy");function Q(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],a=!0,s=!1,o=void 0;try{for(var l,r=t[Symbol.iterator]();!(a=(l=r.next()).done)&&(i.push(l.value),!e||i.length!==e);a=!0);}catch(t){s=!0,o=t}finally{try{a||null==r.return||r.return()}finally{if(s)throw o}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return z(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(i);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return z(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function z(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,a=new Array(e);i<e;i++)a[i]=t[i];return a}var J={},Z=Object(G.throttledPromise)(()=>{},1500,!0);class tt{constructor(){if(this.ensureUrlReject=null,this._currentAudio=!1,this._isPlaying=!1,this._prevPlaylist=null,this._currentPlaylist=null,this._playlists=[],this.subscribers=[],this._statusExport={},this._currentPlayingRows=[],this._podcastsActionRef={},this._podcastsActionLastId={},this._allowPrefetchNext=!1,!vk.isBanned){s.AudioUtils.debugLog("Player creation"),this.eventBus=new f.EventBus;var t,e=new _.WebPlayerAdapter(this);this.stats=new c.AudioStats(e),this.ads=new g.AudioAds(this,tt.getVersion()),this.connectEvents(),V(),this._initImpl(),this._initEvents(),this._restoreVolumeState(),this._podcastCleanStates(),this._listenStatusExport(),setTimeout(()=>{this.restoreState(),s.AudioUtils.toggleAudioHQBodyClass(),this.updateCurrentPlaying()}),t=this,E.HAS_MEDIA_SESSION&&(n&&(n.eventBus.unsubscribe(l.events.PLAY,w),n.eventBus.unsubscribe(l.events.PLAYLIST_CHANGED,I)),(n=t).eventBus.subscribe(l.events.PLAY,w),n.eventBus.subscribe(l.events.PLAYLIST_CHANGED,I))}}static getVersion(){return 15}static _sendLCNotification(){var t=window.Notifier;t&&t.lcSend("audio_start");try{window.Videoview&&Videoview.togglePlay(!1)}catch(t){}}static showHQLabel(t){var e="_audio_show_hq_label";return void 0===t?!!ls.get(e):(t=!!t,ls.set(e,t),s.AudioUtils.toggleAudioHQBodyClass(),t)}static getAudioElementsByAudioId(t,e){return geByClass("_audio_row_"+t,e)}static getDeviceId(){var t=ls.get(tt.LS_PREFIX+tt.LS_UUID);return t||(t=A(),ls.set(tt.LS_PREFIX+tt.LS_UUID,t)),t}static showSubscriptionPopup(){showBox("/al_audio.php",{act:"subscription_box"},{params:{containerClass:"audio_subscription_popup",grey:!0,width:520}})}static getDurationType(){return intval(ls.get(tt.LS_PREFIX+tt.LS_DURATION_TYPE))}static _setTabIcon(t){setFavIcon(tt.tabIcons[t])}static _lsGet(t){return ls.get(tt.LS_PREFIX+t)}static _lsSet(t,e){return ls.set(tt.LS_PREFIX+t,e)}static _podcastGetStates(){return(tt._lsGet(tt.LS_PODCASTS)||J).states||{}}static _podcastSetStates(t){var e=tt._lsGet(tt.LS_PODCASTS)||J;e.states=t,tt._lsSet(tt.LS_PODCASTS,e),J=e}static podcastToggleFave(t,e){if(e){e=s.AudioUtils.asObject(e);var i=s.AudioUtils.getAudioExtra(e).faveHash;i&&bookmarkPodcast(t,e.fullId,i)}}static podcastGetPlaybackRate(){return(tt._lsGet(tt.LS_PODCASTS)||J).rate||1}static getLang(t){var e=getAudioPlayer();return e&&e.langs?e.langs[t]:t}static clearDeprecatedCacheKeys(){tt._iterateCacheKeys(t=>t===tt.LS_VER)}static clearOutdatedCacheKeys(){(ls.get(tt.LS_PREFIX+tt.LS_SAVED)||0)<vkNow()-72e5&&tt._iterateCacheKeys((t,e)=>!inArray(e,[tt.LS_PL,tt.LS_TRACK,tt.LS_PROGRESS]))}getCurrentAudioLs(){return ap.getCurrentAudio()||tt._lsGet(tt.LS_TRACK)}static clearAllCacheKeys(){tt._iterateCacheKeys(()=>!1),setCookie("remixcurr_audio","",-1)}static _iterateCacheKeys(t){P.vkLocalStorage.getPrefixedKeys(tt.LS_KEY_PREFIX+"_").forEach(e=>{var i=Q(e.split("_"),3),a=i[1],s=i[2];t(a,s)||P.vkLocalStorage.removeItem(s)})}_initImpl(){this._impl&&this._impl.destroy();var t=0,e=!1,i=e=>{if(-1!==t){if(e&&(t++,this.implTaskManager.delay(200),t>3)){t=-1;var i=new MessageBox({title:getLang("global_error")}).content(getLang("audio_error_loading")).setButtons("Ok",(function(){t=0,curBox().hide()}));return i.show(),Object(p.setWorkerTimeout)((function(){t=0,i.hide()}),3e3),this.notify(l.events.ENDED),void this.notify(l.events.FAILED)}s.AudioUtils.isPodcast(this.getCurrentAudio())?(this.setIsPlaying(!1),this.notify(l.events.PAUSE),this.notify(l.events.ENDED),this.stop()):this._repeatCurrent?(this._autoNext=!0,this.notify(l.events.ENDED),this.notify(l.events.PROGRESS,0),this.implTaskManager.seekImmediate(0),Object(p.setWorkerTimeout)(()=>{this._impl&&this._impl.clearAudioNode&&(this._impl.stop(),this._implSetUrl(this.getCurrentAudio())),this._implPlay()})):(this.setIsPlaying(!1),this.notify(l.events.ENDED),this.playNext(!0))}},a={onpause:()=>{this.setIsPlaying(!1),this.notify(l.events.PAUSE),e=!1},onplay:()=>{this.setIsPlaying(!0),this.setVolume(this.getVolume()),this.notify(l.events.PLAY),e=!1},onBufferUpdate:t=>{this.notify(l.events.BUFFERED,t)},onEnd:i,onFail:()=>{this._sendPlayerErrorStats(this._impl),i(!0)},onCanPlay:()=>this.notify(l.events.CAN_PLAY),onProgressUpdate:(t,i)=>{var a=this.getCurrentAudio();if(!this._muteProgressEvents&&a){var o=this._impl.getDuration()||a[s.AudioUtils.AUDIO_ITEM_INDEX_DURATION];this.notify(l.events.PROGRESS,t,o,i),!vk.id&&o-i<tt.UNAUTH_FADE_TIME&&!e&&(e=!0,this.fadeOut(1e3*tt.UNAUTH_FADE_TIME))}},onFrequency:t=>{this.notify(l.events.FREQ_UPDATE,t)}};this._impl=new h.AudioPlayerHTML5(a),this.implTaskManager=new x.AudioTaskManager(this._impl),this.implTaskManager.setVolume(0)}fadeIn(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:300;this.implTaskManager.setVolume(this.getVolume(),!0,t)}fadeOut(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:300;this.implTaskManager.setVolume(0,!0,t)}onMediaKeyPressedEvent(t){var e=this.getCurrentAudio();this.getCurrentPlaylist();if(e)switch(t.keyCode){case 179:this.isPlaying()?this.pause():this.play();break;case 178:this.seek(0),this.pause();break;case 177:this.playPrev();break;case 176:this.playNext()}}deletePlaylist(t){for(var e=0;e<this._playlists.length;e++)this._playlists[e]===t&&this._playlists.splice(e,1)}mergePlaylistData(t,e){if(!t.hasMore())return t;this._playlists.forEach(i=>{i.getId()===t.getId()&&i.getOwnerId()===t.getOwnerId()&&i.mergeWith(e)})}deleteCurrentPlaylist(){delete this._currentAudio,delete this._currentPlaylist,this.stop(),this.notify(l.events.UPDATE),this.notify(l.events.PLAYLIST_CHANGED),this.updateCurrentPlaying()}updateCurrentPlaying(t){t=!!t;var e=s.AudioUtils.asObject(this.getCurrentAudio()),i=[];if(e){var a=geByClass("_audio_row_"+e.fullId);i=i.concat([].slice.call(a))}for(var o=0,l=this._currentPlayingRows.length;o<l;o++){var r=this._currentPlayingRows[o];r&&!inArray(r,i)&&this.toggleCurrentAudioRow(r,!1,t)}if(e)for(var d=0,n=i.length;d<n;d++){var u=i[d];if(u){if(gpeByClass("article_editor_canvas",u))continue;this.toggleCurrentAudioRow(u,!0,t)}}this._currentPlayingRows=i,each(geByClass("_audio_pl"),(t,e)=>removeClass(e,"audio_pl__playing"));var _=this.getCurrentPlaylist();if(this.isPlaying()&&_){var c=geByClass(`_audio_pl_${_.getOwnerId()}_${_.getPlaylistId()}`);c&&each(c,(t,e)=>addClass(e,"audio_pl__playing"))}}scrollToCurrentPlaying(t,e){var i=tt.getAudioElementsByAudioId(t);window.AudioPage&&i.forEach(t=>{var i=currentAudioPage(t);if(i&&i._scroll){var a=i.getPageContainer();tt.getAudioElementsByAudioId(e,a).length||i.drawMore(),i.scrollIntoView(tt.getAudioElementsByAudioId(e,a)[0],150)}})}toggleCurrentAudioRow(t,e,i){var a=s.AudioUtils.getAudioFromEl(t,!0);addClass(t,s.AudioUtils.AUDIO_CURRENT_CLS),a.withInlinePlayer&&toggleClass(t,"audio_row__player_transition",i),(i=!!a.withInlinePlayer&&i)?setTimeout(()=>this._updateAudioEl(e,t,a,i),0):this._updateAudioEl(e,t,a,i)}_updateAudioEl(t,e,i,a){var o=geByClass1("_audio_row__play_btn",e),r=geByClass1("_audio_row__title",e),d=geByClass1("_audio_row__duration",e),n=s.AudioUtils.getDurationMod(t?i.duration:i.duration*this.getCurrentProgress());t&&e&&!1===this.isPlaying()&&(removeClass(e,"audio_row__playing"),o&&attr(o,"aria-label",getLang("global_audio_play")),r&&attr(r,"role",""));var u=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(d){var i=s.AudioUtils.getDurationMod(t);d.innerHTML=e+formatTime(t),i!==n&&(replaceClass(d,s.AudioUtils.AUDIO_DURATION_CLS+"-"+n,s.AudioUtils.AUDIO_DURATION_CLS+"-"+i),n=i)}};if(i.withInlinePlayer&&(t?this._addRowPlayer(e):this._removeRowPlayer(e)),t){this.on(e,[l.events.PLAY,l.events.PLAY_REQUESTED],t=>{s.AudioUtils.asObject(t).fullId===i.fullId&&(addClass(e,s.AudioUtils.AUDIO_PLAYING_CLS),o&&attr(o,"aria-label",getLang("global_audio_pause")),r&&attr(r,"role","heading"))}),this.on(e,l.events.PROGRESS,(t,e,a)=>{if(i.withInlinePlayer||!this.ads.isPlaying()){a=intval(a);var s=0,o="";tt.getDurationType()?(s=Math.round(a-e*a),o="-"):s=Math.round(e*a),u(s,o)}else u(i.duration)});var _=data(e,"bars");if(!_&&(i.isWithCovers||i.isNumeric||i.isPodcastListSnippet)){if(_=se('<canvas class="audio_row__sound_bars"></canvas>'),i.isPodcastListSnippet?geByClass1("podcast_list_snippet__cover",e).appendChild(_):e.appendChild(_),_.width=s.AudioUtils.AUDIO_ROW_COVER_SIZE*(isRetina()?2:1),_.height=s.AudioUtils.AUDIO_ROW_COVER_SIZE*(isRetina()?2:1),_.style.width=s.AudioUtils.AUDIO_ROW_COVER_SIZE,_.style.height=s.AudioUtils.AUDIO_ROW_COVER_SIZE,isRetina())_.getContext("2d").scale(2,2);var c=i.isNumeric;this.on(e,l.events.FREQ_UPDATE,(t,e)=>it(_,e,c)),it(_,[0,0,0,0],c),data(e,"bars",_)}toggleClass(e,s.AudioUtils.AUDIO_PLAYING_CLS,this.isPlaying())}else{this.off(e),removeClass(e,s.AudioUtils.AUDIO_PLAYING_CLS),removeClass(e,s.AudioUtils.AUDIO_CURRENT_CLS),u(i.duration),o&&attr(o,"aria-label",getLang("global_audio_play")),r&&attr(r,"role","");var h=data(e,"bars");h&&(re(h),data(e,"bars",null))}a?setTimeout(()=>{var t=s.AudioUtils.getAudioFromEl(e,!0);toggleClass(e,s.AudioUtils.AUDIO_CURRENT_CLS,!!t.isCurrent)},0):toggleClass(e,s.AudioUtils.AUDIO_CURRENT_CLS,t)}_removeRowPlayer(t){removeClass(t,s.AudioUtils.AUDIO_CURRENT_CLS);var e=data(t,"player_inited");if(e){setTimeout(()=>re(geByClass1("_audio_inline_player",t)),200);var i=geByClass1("_audio_duration",t);i&&(i.innerHTML=formatTime(s.AudioUtils.getAudioFromEl(t,!0).duration)),this.off(t),each(e.sliders,(t,e)=>e.destroy()),data(t,"player_inited",!1);var a=geByClass1("has_audio_player",t);a&&removeClass(a,"has_audio_player")}}_addRowPlayer(t){if(!(geByClass1("_audio_inline_player",t)||hasClass(t,"podcast_list_snippet")||hasClass(t,"podcast_snippet__controls")||hasClass(t,"PodcastWidget__player"))){var e=se(vk.audioInlinePlayerTpl||getTemplate("audio_inline_player")),i=geByClass1("_audio_player__place",t);i.appendChild(e),addClass(i,"has_audio_player");var a=new Slider(geByClass1("audio_inline_player_volume",e),{value:this.getVolume(),backValue:0,size:1,hintClass:"audio_player_hint",withBackLine:!0,log:!0,formatHint:t=>Math.round(100*t)+"%",onChange:t=>this.setVolume(t)}),o=new Slider(geByClass1("audio_inline_player_progress",e),{value:0,backValue:0,size:1,hintClass:"audio_player_hint",withBackLine:!0,formatHint:t=>formatTime(Math.round(t*this._impl.getDuration())),onEndDragging:t=>{var i=s.AudioUtils.asObject(this.getCurrentAudio());i&&s.AudioUtils.isPodcast(i)&&this.podcastSetActionRef(i,s.AudioUtils.PodcastsLogs.ACTION_SEEK,"",e),this.seek(t)}});this.ads.isPlaying()&&o.toggleAdState(!0),vk.id||o.setBlocked(!0),this.on(t,l.events.AD_DEINITED,()=>{}),this.on(t,l.events.AD_READY,()=>{}),this.on(t,l.events.AD_STARTED,()=>{o.toggleAdState(!0),o.setBackValue(0)}),this.on(t,l.events.AD_COMPLETED,()=>o.toggleAdState(!1)),this.on(t,l.events.START_LOADING,()=>o.toggleLoading(!0)),this.on(t,l.events.CAN_PLAY,()=>o.toggleLoading(!1)),this.on(t,l.events.BUFFERED,(t,e)=>o.setBackValue(e)),this.on(t,l.events.PROGRESS,(t,e)=>{o.toggleLoading(!1),o.setValue(e)}),this.on(t,l.events.VOLUME,(t,e)=>{a.setValue(e)}),data(t,"player_inited",{sliders:[a,o]})}}hasStatusExport(){for(var t in this._statusExport)if(this._statusExport.hasOwnProperty(t)&&this._statusExport[t])return!0;return!1}getStatusExportInfo(){return this._statusExport}setStatusExportInfo(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._statusExport=t,e&&this.setStatusExportInfoStorage(t)}setStatusExportInfoStorage(t){tt._lsSet(tt.LS_STATUS_EXPORT,t)}deleteAudioFromAllPlaylists(t){t=isObject(t)||isArray(t)?s.AudioUtils.asObject(t).fullId:t,each(this._playlists,(e,i)=>i.removeAudio(t))}updateAudio(t,e){var i="";return isString(t)?i=t:isArray(t)&&(i=s.AudioUtils.asObject(t).fullId),e||(e=t),each(this._playlists,(t,a)=>{for(var o=a.getAudiosList(),l=function(t,a){`${o[t][s.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]}_${o[t][s.AudioUtils.AUDIO_ITEM_INDEX_ID]}`===i&&(isObject(e)&&each(e,(e,i)=>o[t][e]=i),isArray(e)&&(o[t]=e))},r=0,d=o.length;r<d;r++)l(r)}),`${this._currentAudio[s.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]}_${this._currentAudio[s.AudioUtils.AUDIO_ITEM_INDEX_ID]}`===i&&(isObject(e)&&each(e,(t,e)=>this._currentAudio[t]=e),isArray(e)&&(this._currentAudio=e,this.notify(l.events.CURRENT_CHANGED))),this.notify(l.events.UPDATE),t}_triggerTNSPixel(){var t=tt._lsGet("tns_triggered_time_v3")||0,e=vkNow();e-t<864e5||(tt._lsSet("tns_triggered_time_v3",e),vkImage().src="https://www.tns-counter.ru/V13a****mail_ru/ru/CP1251/tmsec=mail_audiostart/"+irand(1,1e9))}_restoreVolumeState(){tt.clearDeprecatedCacheKeys(),tt.clearOutdatedCacheKeys();var t=tt._lsGet(tt.LS_VOLUME);this._userVolume=null==t||!1===t?y.DEFAULT_VOLUME:t}restoreState(){if(!vk.widget&&(tt.clearDeprecatedCacheKeys(),tt.clearOutdatedCacheKeys(),!window.cur.audioPreventRestoreTrack)){this._currentAudio=tt._lsGet(tt.LS_TRACK);var t=tt._lsGet(tt.LS_PL);t&&(t=JSON.parse(t),this._currentPlaylist=new AudioPlaylist(t),this._initPlayingContext(t.context),t.originalPlaylistRawId&&(this._currentPlaylist._originalPlaylistRawId=t.originalPlaylistRawId)),this._currentPlaylist&&this._currentAudio?this.notify(l.events.UPDATE):this._currentPlaylist=this._currentAudio=!1;var e=0;if(s.AudioUtils.isPodcast(this._currentAudio))e=((tt._podcastGetStates()[`${this._currentAudio[s.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]}_${this._currentAudio[s.AudioUtils.AUDIO_ITEM_INDEX_ID]}`]||{}).position||0)/this._currentAudio[s.AudioUtils.AUDIO_ITEM_INDEX_DURATION];else e=tt._lsGet(tt.LS_PROGRESS)||0;this._currentAudio&&e&&this._impl&&(this._implSetUrl(this._currentAudio,!0),e<1&&this.implTaskManager.seek(e),this.implTaskManager.setVolume(0)),this.notify(l.events.CURRENT_CHANGED),this._updatePlaybackRate()}}_implPlay(){var t=s.AudioUtils.asObject(this.getCurrentAudio());this.implTaskManager.play(t.url).then(()=>{if(this._muteProgressEvents=!1,this._allowPrefetchNext=!0,t.actionHash&&(V(),ajax.post("al_audio.php",{act:"start_playback",audio_id:t.id,owner_id:t.owner_id,hash:t.actionHash,uuid:tt.getDeviceId()},{onFail:()=>!0})),s.AudioUtils.isPodcast(t)){var e=this._podcastRestoreState();this._podcastUpdateState(t,e,0,s.AudioUtils.PodcastsLogs.ACTION_PLAY)}})}_implSetUrl(t,e){this.implTaskManager.clearTask(x.TaskName.URL),e||this.notify(l.events.START_LOADING);var i=Object(v.asObject)(t);return this._ensureHasURL(i).then(t=>this.implTaskManager.setUrl(t.url).catch(()=>{this.implTaskManager.clearAllTasks(),this._onFailedUrl()})).catch(()=>!0)}toggleDurationType(){var t=tt.LS_PREFIX+tt.LS_DURATION_TYPE,e=intval(ls.get(t));ls.set(t,!e),this.notify(l.events.UPDATE,this.getCurrentProgress())}getCurrentProgress(){return this._impl?this._impl.getCurrentProgress():0}getCurrentBuffered(){return this._impl?this._impl.getCurrentBuffered():0}_initEvents(){var t=window.Notifier;t&&(t.addRecvClbk("audio_start","audio",()=>{this.isPlaying()&&(this.pausedByAudio=Date.now(),this.pause()),delete this.pausedByVideo}),t.addRecvClbk("video_start","audio",()=>{this.isPlaying()&&(this.pause(),this.pausedByVideo=Date.now())}),t.addRecvClbk("video_hide","audio",()=>{!this.isPlaying()&&this.pausedByVideo&&(Date.now()-this.pausedByVideo<18e4&&this.play(),delete this.pausedByVideo)}),t.addRecvClbk("logged_off","audio",()=>{cur.loggingOff=!0,tt.clearAllCacheKeys(),this.stop()}),t.addRecvClbk("stories_video_start","audio",()=>{this.isPlaying()&&(this.pause(),this.pausedByStories=vkNow())}),t.addRecvClbk("stories_video_end","audio",()=>{!this.isPlaying()&&this.pausedByStories&&(vkNow()-this.pausedByStories<18e4&&this.play(),delete this.pausedByStories)}))}addPlaylist(t){this.hasPlaylist(t.getId())||this._playlists.push(t)}_cleanUpPlaylists(){for(var t=0,e=-1,i=this._playlists.length-1;i>=0;i--){var a=this._playlists[i];if(!a.isReference()&&(t+=a.getAudiosCount())>4e3){e=i;break}}if(-1!==e){e+=1;for(var s=this._playlists.slice(0,e),o=this.getCurrentPlaylist(),l=[],r=0;r<s.length;r++){var d=s[r];if(o===d&&(d=!1),d&&!d.isReference())for(var n=e;n<this._playlists.length;n++){var u=this._playlists[n];u.isReference()&&u.getSelf()===d&&(d=!1)}d&&l.push(r)}for(var _=0;_<l.length;_++){var c=l[_];this._playlists.splice(c,1)}l.length&&debugLog("AudioPlayer - "+l.length+" playlists removed")}}hasPlaylist(t,e,i,a){var s;if(a)return this._playlists.find(t=>t.getBlockId()===a||t.getAlbumId()===a)||!1;s=void 0!==e&&void 0!==i?`${t}_${e}_${i}`:t;for(var o=0;o<this._playlists.length;o++){var l=this._playlists[o];if(!l.isReference()&&l.getId()===s)return l}return!1}getPlaylistByBlockId(t){return this.hasPlaylist(null,null,null,t)||null}getPlaylistsByType(t){return this._playlists.filter(e=>e.getType()===t)||null}getPlaylist(t,e,i,a){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(t&&!e&&!i){var o=Q(AudioPlaylist.splitId(t),3);t=o[0],e=o[1],i=o[2]}var l=this.hasPlaylist(t,e,i,s);return l?(l.mergeWith({accessHash:a}),l):new AudioPlaylist({type:t,ownerId:e,albumId:i,hasMore:t!==AudioPlaylist.TYPE_TEMP,accessHash:a,blockId:s})}isFromNextSequence(){return 1===this._seq}isFromPrevSequence(){return-1===this._seq}isAutoPlayed(){return!!this._autoNext}hasPrevAudio(){return!(!this._prevAudio||s.AudioUtils.getAudioFullId(this._currentAudio)===s.AudioUtils.getAudioFullId(this._prevAudio))}hasPrevPlaylist(){return!!this._prevPlaylist}toggleRepeatCurrentAudio(){this._repeatCurrent=!this._repeatCurrent,this._repeatAll=!1}isRepeatCurrentAudio(){return!!this._repeatCurrent}toggleRepeatAll(){this._repeatAll=!this._repeatAll,this._repeatCurrent=!1}isRepeatAll(){return!!this._repeatAll}setNext(t,e){if(vk&&vk.widget&&!vk.id&&window.Widgets)return Widgets.oauth(),!1;if(!hasClass(t,"audio_row__added_next")){addClass(t,"audio_row__added_next");var i=this.getCurrentPlaylist();if(i){var a=s.AudioUtils.asObject(this.getCurrentAudio());if(a&&e.fullId===a.fullId)return;var o=i.indexOfAudio(a);if(-1===o)return;this.notify(l.events.PLAY_NEXT,a.fullId,e.fullId);var r=i.indexOfAudio(e);-1!==r?i.moveAudio(r,o+1):i.addAudio(Object(q.serializeAudio)(e),o+1)}else{var d=s.AudioUtils.getContextPlaylist(t);this.play(e,d.playlist,d.context)}var n=window.AudioPage&&currentAudioPage(t);if(n){var u=n.getPageCurrentPlaylist();u&&n.onUserAction(e,u)}}}on(t,e,i){isArray(e)||(e=[e]),each(e,(e,a)=>this.subscribers.push({context:t,et:a,cb:i}))}off(t){this.subscribers=this.subscribers.filter(e=>e.context!==t)}connectEvents(){var t=this;this.eventBus.precheck=t=>!!this._impl&&!(!this.ads.isPlaying()&&this._muteProgressEvents&&inArray(t,[l.events.BUFFERED,l.events.PROGRESS])),this.eventBus.onAnyCallBack=function(e){for(var i=arguments.length,a=new Array(i>1?i-1:0),s=1;s<i;s++)a[s-1]=arguments[s];return t.onEvent(e,...a)},this.subscribe(l.events.VOLUME,()=>tt._lsSet(tt.LS_VOLUME,this._userVolume)),this.subscribe(l.events.PLAY_REQUESTED,()=>{this.updateCurrentPlaying(!0),this.saveStateCurrentPlaylist(),this._saveStateCurrentAudio(),tt._setTabIcon("play"),this._sendStatusExport()}),this.subscribe(l.events.PLAY,()=>this.updateCurrentPlaying(!0)),this.subscribe(l.events.PLAYLIST_CHANGED,()=>{this.saveStateCurrentPlaylist(),this._saveStateCurrentAudio()}),this.subscribe(l.events.PROGRESS,(t,e,i)=>{var a=this.getCurrentAudio(),o=Object(v.asObject)(a);if(this._listenedTime=i,s.AudioUtils.isPodcast(o))t&&i&&this._podcastUpdateState(o,t,i,s.AudioUtils.PodcastsLogs.ACTION_HEARTBEAT);else if(!this.ads.isPlaying()){var l=this.getCurrentPlaylist(),r=this._impl.getCurrentProgress();if(vk.widget||tt._lsSet(tt.LS_PROGRESS,r),!vk.widget&&this._allowPrefetchNext&&r>=.8){var d=l.getNextAudio(a);d&&this._impl.isFullyLoaded()&&(this._allowPrefetchNext=!1,this._prefetchAudio(d))}}}),this.subscribe(l.events.PAUSE,()=>{this.updateCurrentPlaying(!0);var t=this.getCurrentAudio(),e=Object(v.asObject)(t);s.AudioUtils.isPodcast(e)&&this._podcastUpdateState(e,this.getCurrentProgress(),this._impl.getPlayedTime(),s.AudioUtils.PodcastsLogs.ACTION_PAUSE),tt._setTabIcon("pause")}),this.subscribe(l.events.SEEK,()=>{var t=this.getCurrentAudio(),e=Object(v.asObject)(t);s.AudioUtils.isPodcast(e)&&this._podcastUpdateState(e,this.getCurrentProgress(),this._impl.getPlayedTime(),s.AudioUtils.PodcastsLogs.ACTION_SEEK)}),this.subscribe(l.events.ENDED,()=>{var t=this.getCurrentAudio(),e=Object(v.asObject)(t);s.AudioUtils.isPodcast(e)&&this._podcastUpdateState(e,this.getCurrentProgress(),this._impl.getPlayedTime(),s.AudioUtils.PodcastsLogs.ACTION_HEARTBEAT)})}subscribe(t,e){this.eventBus.subscribe(t,e)}unsubscribe(t,e){this.eventBus.unsubscribe(t,e)}onEvent(t,e,i,a){inArray(t,[l.events.PLAY,l.events.PLAY_REQUESTED,l.events.PAUSE])&&(this.subscribers=this.subscribers.filter(t=>!(t.context instanceof Element)||bodyNode.contains(t.context))),each(this.subscribers||[],(s,o)=>{o.et===t&&o.cb(this.getCurrentAudio(),e,i,a)})}notify(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),a=1;a<e;a++)i[a-1]=arguments[a];this.eventBus.emit(t,...i)}_trackListenedDataSwitch(t,e,i){if(this._currentAudioListenData){this._switchPlaylistRef||(this._switchPlaylistRef=this._currentPlaylist);var a=0,s=this.isAutoPlayed(),o=e&&this._prevContext!==e,l=this._switchPlaylistRef&&i&&this._switchPlaylistRef.getId()!==i.getId();this._seq&&!s?a="next_btn":(o||l)&&(a="playlist_change"),!a&&s&&(a="playlist_next"),this._currentAudioListenData.end_stream_reason=a||"unknown",this._switchPlaylistRef=i}}_sendPlayerErrorStats(t){var e=s.AudioUtils.asObject(this.getCurrentAudio());if(e){var i=e.full_id,a=extend({audio:i,progress:this.getCurrentProgress(),buffered:this.getCurrentBuffered()},t.getErrorData());ajax.post("al_audio.php?act=player_error_stats",a)}}playLive(t,e){var i=this.getPlaylist(AudioPlaylist.TYPE_LIVE,vk.id,data[0]);i.mergeWith({live:t,hasMore:!1}),t=i.getLiveInfo(),ajax.post("al_audio.php",{act:"a_play_audio_status",audio_id:t.audioId,host_id:t.hostId,hash:t.hash},extend(e,{onDone:(t,e,a)=>{i.mergeWith({title:e&&e.title,list:[t]}),this.play(t,i,a)},onFail:()=>!0}))}_listenStatusExport(){window.addEventListener("storage",t=>{if(t.key===tt.LS_PREFIX+tt.LS_STATUS_EXPORT){var e=tt._lsGet(tt.LS_STATUS_EXPORT);this.setStatusExportInfo(e),cur.audioPage&&cur.audioPage.updateStatusExportControls()}})}_sendStatusExport(){var t=s.AudioUtils.asObject(this.getCurrentAudio());if(t){var e=this.statusSent?this.statusSent.split(","):[!1,0],i=vkNow()-intval(e[1]);if(this.hasStatusExport()&&!s.AudioUtils.isPodcast(t)&&(t.id!=e[0]||i>3e5)){var a=this.getCurrentPlaylist(),o=a?a.playbackParams:null;setTimeout(ajax.post.pbind("al_audio.php",{act:"audio_status",full_id:t.fullId,hash:vk.statusExportHash,top:intval(o&&(o.top_audio||o.top))},{onFail:()=>!0}),0),this.statusSent=t.id+","+vkNow()}}}saveStateCurrentPlaylist(){if(!vk.widget){var t=this.getCurrentPlaylist();tt._lsSet(tt.LS_PL,t?t.serialize():null),tt._lsSet(tt.LS_SAVED,vkNow())}}_saveStateCurrentAudio(){if(!vk.widget){var t=this.getCurrentAudio();if(t){var e=clone(t);e[s.AudioUtils.AUDIO_ITEM_INDEX_URL]="",tt._lsSet(tt.LS_TRACK,e),setCookie("remixcurr_audio",`${t[s.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]}_${t[s.AudioUtils.AUDIO_ITEM_INDEX_ID]}`,1)}else tt._lsSet(tt.LS_TRACK,null),setCookie("remixcurr_audio",null,1)}}getListenedTime(){return this._listenedTime}seekCurrentAudio(t,e){if(this.ads.isPlaying())return!1;var i=(e=e||10)/s.AudioUtils.asObject(this.getCurrentAudio()).duration,a=this.getCurrentProgress()+(t?i:-i);a=Math.max(0,Math.min(1,a)),this.seek(a)}setVolume(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=Math.min(1,Math.max(0,t));this._userVolume!==i&&(this._userVolume=i,this.notify(l.events.VOLUME,i)),this.implTaskManager.setVolume(i,e),this.ads.updateVolume()}getVolume(){return void 0===this._userVolume?.8:this._userVolume}seek(t){this.implTaskManager.seek(t),this.notify(l.events.SEEK)}seekToTime(t,e){var i=this.getCurrentAudio();if(!i)return 0;var a=t/i[s.AudioUtils.AUDIO_ITEM_INDEX_DURATION];if(a=Math.max(0,a),a=Math.min(a,1),this.seek(a),s.AudioUtils.isPodcast(i)){var o="",l=s.AudioUtils.asObject(i);e&&(o=s.AudioUtils.PodcastsLogs.ACTION_TIME_MARKER,this.podcastSetActionRef(l,s.AudioUtils.PodcastsLogs.ACTION_SEEK,e)),this._podcastUpdateState(l,a,0,o)}return a}_ensureHasURL(t){this._currentUrlEnsure=this._currentUrlEnsure||{};var e,i=[];if(!t)return Promise.reject();if(t.url)return Promise.resolve(t);if(!this._currentUrlEnsure[t.fullId]){var a=this.getCurrentPlaylist(),o=a.indexOfAudio(t);if(o>=0)for(var l=o;l<o+5;l++){var r=s.AudioUtils.asObject(a.getAudioAt(l));r&&!r.url&&!this._currentUrlEnsure[r.fullId]&&r.urlHash&&(i.push(r.fullId+"_"+r.actionHash+"_"+r.urlHash),this._currentUrlEnsure[r.fullId]=!0)}}return!i.length&&this.currentEnsureUrlPromise?e=this.currentEnsureUrlPromise:(e=new Promise((t,e)=>{this.ensureUrlReject&&this.ensureUrlReject(),this.ensureUrlReject=e,Z().then(()=>this.fetchAudioUrls(i)).then(e=>{this.ensureUrlReject=null,t(e)}).catch(a=>{switch(a){case"bad_hash":this.ensureUrlReject=null,this.fetchAudios(i).then(t=>this.fetchAudioUrls(t)).then(t).catch(()=>!0);break;case"no_audios":this.ensureUrlReject=null,e()}return!0})}),this.currentEnsureUrlPromise=e),e.then(e=>(Array.isArray(e)&&e.forEach(e=>{if(t.fullId===Object($.getAudioFullId)(e)){var i=Object(v.asObject)(e);t.url=i.url,t.ads=i.ads,t.flags=i.flags,t.extra=i.extra}}),t))}fetchAudioUrls(t){return new Promise((e,i)=>{ajax.post("al_audio.php?act=reload_audio",{ids:t.join(",")},{onDone:(t,i,a,o)=>{this.setStatusExportInfo(i),this._listenedHash=a,o&&this._podcastSaveData(o),each(t,(t,e)=>{e=s.AudioUtils.asObject(e);var i={};i[s.AudioUtils.AUDIO_ITEM_INDEX_URL]=e.url,i[s.AudioUtils.AUDIO_ITEM_INDEX_ADS]=e.ads,i[s.AudioUtils.AUDIO_ITEM_INDEX_FLAGS]=e.flags,i[s.AudioUtils.AUDIO_ITEM_INDEX_EXTRA]=e.extra,this.updateAudio(e.fullId,i),this._currentAudio&&Object($.getAudioFullId)(this._currentAudio)===e.fullId&&(this._currentAudio[s.AudioUtils.AUDIO_ITEM_INDEX_URL]=e.url,this._currentAudio[s.AudioUtils.AUDIO_ITEM_INDEX_ADS]=e.ads,this._currentAudio[s.AudioUtils.AUDIO_ITEM_INDEX_FLAGS]=e.flags,this._currentAudio[s.AudioUtils.AUDIO_ITEM_INDEX_EXTRA]=e.extra),delete this._currentUrlEnsure[e.fullId]}),e(t)},onFail:t=>(i(t),!0)})})}fetchAudios(t){return new Promise((e,i)=>{ajax.post("al_audio.php?act=reload_audios",{audio_ids:t.join(",")},{onDone:t=>{var a=[],s=this.getCurrentPlaylist().getAudiosList();if(Array.isArray(t)){for(var o=t.reduce((t,e)=>(t[Object($.getAudioFullId)(e)]=e,t),{}),l=0;l<s.length;l++){var r=Object($.getAudioFullId)(s[l]);if(o[r]){s[l]=o[r];var d=Object(v.asObject)(o[r]);a.push(`${d.fullId}_${d.actionHash}_${d.urlHash}`)}}e(a)}else i()}})})}toggleAudio(t,e){if(vk&&vk.widget&&!vk.id&&window.Widgets&&!vk.widgetPodcast)return Widgets.oauth(),!1;if(domClosest("_audio_row__tt",e.target))return cancelEvent(e);var i=domClosest("_audio_row",t),a=s.AudioUtils.getAudioFromEl(i,!0);if(window.getSelection&&window.getSelection().rangeCount){var o=window.getSelection().getRangeAt(0);if(o){var l=o.commonAncestorContainer;if(l&&domClosest("_audio_row",l)===i&&o.startOffset!==o.endOffset)return!1}}if(e&&hasClass(e.target,"mem_link"))return nav.go(attr(e.target,"href"),e,{navigateToUploader:!0}),cancelEvent(e);if(hasClass(e.target,"_audio_row__title_inner")){if(s.AudioUtils.isPodcast(a))return showPodcast(i,a.fullId),cancelEvent(e);if(a.lyrics&&!a.isInAttach)return s.AudioUtils.toggleAudioLyrics(i,a),cancelEvent(e)}if(hasClass(e.target.parentNode,"audio_row__performers")){if(checkEvent(e)||vk.widget)return!0;if(!gpeByClass("_ape_audio_item",e.target)){var r=domData(e.target,"performer");if(r)return s.AudioUtils.audioSearchPerformer(e.target,r,e),cancelEvent(e)}return!0}var d=cur.cancelClick||e&&(hasClass(e.target,"audio_lyrics")||domClosest("_audio_duration_wrap",e.target)||domClosest("_audio_inline_player",e.target)||domClosest("audio_performer",e.target)),n=hasClass(e.target,"slider")||domClosest("slider",e.target),u=cur._sliderMouseUpNowEl&&(cur._sliderMouseUpNowEl===geByClass1("audio_inline_player_progress",i)||cur._sliderMouseUpNowEl===geByClass1("audio_inline_player_volume",i));if((n||u)&&(d=!0),delete cur.cancelClick,delete cur._sliderMouseUpNowEl,d)return!0;if(s.AudioUtils.isClaimedAudio(a)||a.isReplaceable){var _=s.AudioUtils.getAudioExtra(a).claim;if(_)return void(hasClass(i,"no_actions")||a.isInEditBox||showAudioClaimWarning(a,_,s.AudioUtils.replaceWithOriginal.bind(s.AudioUtils,i,a)))}if(this.podcastSetActionRef(a,a.isPlaying?s.AudioUtils.PodcastsLogs.ACTION_PAUSE:s.AudioUtils.PodcastsLogs.ACTION_PLAY,"",i),a.isPlaying)this.pause();else{var c=s.AudioUtils.getContextPlaylist(i);this.play(a.fullId,c.playlist,a.context||c.context),cur.audioPage&&cur.audioPage.onUserAction(a,c.playlist)}s.AudioUtils.onRowOver(i,!1,!0)}_onFailedUrl(){this.notify(l.events.FAILED),this.isPlaying()&&(this.pause(),this.playNext(!0,!0))}playNextPlaylist(t,e,i){var a=this.getPlaylist(AudioPlaylist.TYPE_PLAYLIST,t,e,i);a.loadAll(()=>{var t=this.getCurrentPlaylist();if(t)t.addAudio(a.getAudiosList());else{this._currentPlaylist=new AudioPlaylist(a);var e=a.getAudioAt(0);e&&(this._currentAudio=e,this.notify(l.events.UPDATE),this.notify(l.events.PLAYLIST_CHANGED),this.updateCurrentPlaying(),this.isPlaying()||this.play(e.fullId,a))}}),boxQueue&&boxQueue.hideAll(),layers&&layers.fullhide&&layers.fullhide()}playPlaylist(t,e,i,a,s){if(vk&&vk.widget&&!vk.id&&window.Widgets)return Widgets.oauth(),!1;this.playNextInPlaylist(t,e,i,a,{shuffled:s,preDoPlay:t=>{s&&(t.isShuffled()&&t.shuffle(0),t.shuffle(irand(1,999999),!0))}})}playBlock(t,e,i,a,s){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"default";this.playNextInPlaylist(t,e,i,a,{type:s,trackType:o,shuffled:!1})}playNextInPlaylist(t,e,i,a){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=this.getCurrentPlaylist(),l=this.getPlaylist(s.type||AudioPlaylist.TYPE_PLAYLIST,t,e,i);if(o&&o.getId()===l.getId()&&this.isPlaying()&&!s.shuffled)this.pause();else{var r=!1,d=()=>{if(!r){r=!0,s.preDoPlay&&s.preDoPlay(l);var t=l.getNextAudio(!1,!0);t&&this.play(t,l,a)}};l.getAudiosCount()&&!s.shuffled?d():this._impl&&this._impl.preparePlay&&!this.ads.isPlaying()&&this._impl.preparePlay(),l.load(0,d,null,s.trackType)}}_initPlayingContext(t){this._playingContext=t}getListenedHash(){return this._listenedHash||""}_getPlayingContext(){return this._playingContext||""}_getPlayingContextSection(){return this._getPlayingContext().split(":")[0]}play(t,e,i,a,o){if(!cur.loggingOff&&this._impl){this._seq=a,this._autoNext=o,this._prevAudio=this._currentAudio,this._cleanUpPlaylists(),(isObject(t)||isArray(t))&&(t=s.AudioUtils.asObject(t))&&(t=t.fullId);var r=s.AudioUtils.asObject(this._currentAudio),d=this.getCurrentPlaylist();!t&&r&&(t=r.fullId);var n=!1,u=t&&r&&t==r.fullId;e?d&&(n=e==d.getSelf()||e==d):(e=d,n=!0),n||i||debugLog("New playlist play init without context"),i&&(this._prevContext=this._playingContext,this._initPlayingContext(i));var _=e.getAudio(t);u||(_&&e.load(e.indexOfAudio(_)+3),this._trackListenedDataSwitch(r,i,e),e.getType()===AudioPlaylist.TYPE_SEARCH&&e.indexOfAudio(_)>=e.getLocalFoundCount()&&e.sendSearchStats("search_play"),r&&s.AudioUtils.isPodcast(r)&&this.isPlaying()&&this._podcastUpdateState(r,this.getCurrentProgress(),this._impl.getPlayedTime(),s.AudioUtils.PodcastsLogs.ACTION_PAUSE,{needResetListen:!0}),this.ads.isPlaying()||this.ads.deinit()),n||(this._currentPlaylist&&(this._prevPlaylist=this._currentPlaylist,this._prevAudio=this._currentAudio),this._currentPlaylist=new AudioPlaylist(e),this.notify(l.events.PLAYLIST_CHANGED)),u?this.ads.isPlaying()?this.ads.resume():this.isPlaying()||(this.setIsPlaying(!0),tt._sendLCNotification(),this.implTaskManager.clearAllTasks(),this._implSetUrl(r).then(()=>{this._implPlay(),this._updatePlaybackRate(),this.implTaskManager.setVolume(this.getVolume(),!!this._impl.getCurrentProgress()),s.AudioUtils.isPodcast(_)&&this._podcastUpdateState(s.AudioUtils.asObject(_),this.getCurrentProgress(),this._impl.getPlayedTime())}).catch(()=>{})):t&&_&&(!o&&r&&this._impl.setUrl(y.SILENCE),this._currentAudio=_,this.setIsPlaying(!0),this.ads.isPlaying()?this.ads.resume():(this.notify(l.events.PLAY_REQUESTED,!0,intval(a),o),tt._sendLCNotification(),this._muteProgressEvents=!0,this.implTaskManager.clearAllTasks(),this._impl.preparePlay&&this._impl.preparePlay(),this.ads.startPlay(s.AudioUtils.asObject(_),()=>this.playAfterAd()),this.notify(l.events.PROGRESS,0)),this.updateCurrentPlaying(!0),r&&this.scrollToCurrentPlaying(r.fullId,t))}}playAfterAd(){this.notify(l.events.CURRENT_CHANGED);var t=this.getCurrentAudio();this.implTaskManager.setVolume(0),t&&(this.notify(l.events.UPDATE),this._implSetUrl(t).then(()=>{this._implPlay(),this._updatePlaybackRate(),vk.id?this.implTaskManager.setVolume(this.getVolume()):this.fadeIn(1e3*tt.UNAUTH_FADE_TIME),this._triggerTNSPixel()}).catch(()=>{}))}preloadDefaultPlaylist(t){browser.safari&&!tt._lsGet(tt.LS_TRACK)&&this.getPlaylist(AudioPlaylist.TYPE_PLAYLIST,vk.id,AudioPlaylist.DEFAULT_PLAYLIST_ID,t).load()}instantPlay(t,e,i){var a=!browser.safari&&e&&e.shiftKey;this.playPlaylist(vk.id,AudioPlaylist.DEFAULT_PLAYLIST_ID,i,"header",a),statlogsValueEvent("client_header_play_button",a?"shuffle":"play"),setTimeout(()=>{addClass(t,"loading")},400)}_prefetchAudio(t){(t=s.AudioUtils.asObject(t))&&t.url&&this._impl.prefetch(t.url)}getCurrentPlaylist(){return this._currentPlaylist}getPlaylists(){return clone(this._playlists)}pause(){this.ads.isPlaying()&&setTimeout(()=>this.ads.pause(),100),this.implTaskManager.setVolume(0,!0),this.implTaskManager.pause()}stop(){this.setIsPlaying(!1),this.ads.isPlaying()?this.ads.stop():this._impl.stop(),this.notify(l.events.STOP)}isPlaying(){return this._isPlaying}setIsPlaying(t){this._isPlaying=t}getCurrentAudio(){return this._currentAudio}playNext(t){this._playNext(1,t)}playPrev(){this._playNext(-1)}_playNext(t,e){if(!this.ads.isPlaying()){var i=10,a=this.getCurrentAudio(),o=this.getCurrentPlaylist(),r=(t,i)=>{s.AudioUtils.isClaimedAudio(t)||this.play(t,o,!1,i,e)};if(a&&o)if(t>0){for(var d=o.getNextAudio(a);i&&d&&s.AudioUtils.isClaimedAudio(d);)d=o.getNextAudio(d),i--;if(d)r(d,1);else if(o.isLive())this._muteProgressEvents=!0,o.fetchNextLiveAudio(t=>r(t,1));else{if(d=o.getAudioAt(0),s.AudioUtils.isClaimedAudio(d))for(var n=o.getAudiosList(),u=o.getAudiosCount(),_=0;_<u;_++){var c=n[_];if(!s.AudioUtils.isClaimedAudio(c)){d=c;break}}if(!this.isRepeatAll())if(o.indexOfAudio(a)+1===o.getAudiosCount())return this.implTaskManager.seekImmediate(0),this.stop(),void(s.AudioUtils.isClaimedAudio(d)||(this._currentAudio=d,this._implSetUrl(this._currentAudio),this.updateCurrentPlaying(!0),this.notify(l.events.CURRENT_CHANGED),this.notify(l.events.UPDATE)));r(d,1)}}else{var h=o.indexOfAudio(this._currentAudio)-1;if(h<0)this.seek(0);else{for(var p=o.getAudioAt(h);i&&p&&s.AudioUtils.isClaimedAudio(p);)p=o.getAudioAt(--h),i--;p?r(p,-1):this.seek(0)}}}}adsGetCurrentProgress(){return this.ads.getCurrentProgress()}_podcastUpdateState(t,e,i,a,s){var o=tt._podcastGetStates(),l=Math.round(t.duration*e);o[t.fullId]={t:vkNow(),position:l},tt._podcastSetStates(o),a&&this._podcastSendLogs(a,t,i,l,s)}_podcastSendLogs(t,e,i,a,o){if(e&&t&&s.AudioUtils.isPodcast(e)&&(!cur._podcastsActionId||!cur._podcastsActionId[t]||this._podcastsActionLastId[t]!==cur._podcastsActionId[t])){var l=this._podcastsActionRef[e.fullId]||{},r=l[t]||{};s.AudioUtils.PodcastsLogs.log(t,extend({audio:e,position:a,listen:i},r,o||{})),delete l[t],this._podcastsActionLastId[t]=cur._podcastsActionId?cur._podcastsActionId[t]:null}}podcastSetActionRef(t,e,i,a){t=s.AudioUtils.asObject(t),e&&s.AudioUtils.isPodcast(t)&&(this._podcastsActionRef[t.fullId]=this._podcastsActionRef[t.fullId]||{},this._podcastsActionRef[t.fullId][e]={ref:i,refEl:a},cur._podcastsActionId=cur._podcastsActionId||{},cur._podcastsActionId[e]=irand(0,1e6))}_podcastCleanStates(){var t=tt._podcastGetStates(),e=!1;return each(t,(i,a)=>{Date.now()-a.t>2419200&&(delete t[i],e=!0)}),e&&tt._podcastSetStates(t),t}_podcastSaveData(t){var e=tt._podcastGetStates();each(t,(t,i)=>{var a=i.state;if(a){var s=+a[1];(!e[t]||!e[t][1]||s&&s>e[t][1])&&(e[t]={position:+a[0],t:Date.now()})}}),tt._podcastSetStates(e)}_podcastRestoreState(){var t=s.AudioUtils.asObject(this.getCurrentAudio());if(!s.AudioUtils.isPodcast(t))return 0;var e=0;cur.podcastSeekToTime?(e=this.seekToTime(cur.podcastSeekToTime,cur.podcastSeekToTimeRef),delete cur.podcastSeekToTime,delete cur.podcastSeekToTimeRef):(e=((tt._podcastGetStates()[t.fullId]||{}).position||0)/t.duration)&&e<1&&this.implTaskManager.seek(e);return e&&e<1?(this.updateCurrentPlaying(),e):0}getCurrentFaveStatus(){return!!s.AudioUtils.isPodcast(this._currentAudio)&&s.AudioUtils.getAudioExtra(this._currentAudio).fave}_updatePlaybackRate(){var t=!this.ads.isPlaying()&&s.AudioUtils.isPodcast(this._currentAudio)?tt.podcastGetPlaybackRate():1;this.implTaskManager.updatePlaybackRate(t)}podcastChangePlaybackRate(t){var e=tt._lsGet(tt.LS_PODCASTS)||J,i=e.rate||1;t?i-=tt.PLAYBACK_RATE_STEP:i+=tt.PLAYBACK_RATE_STEP,!t&&i>tt.PLAYBACK_RATE_MAX?i=1:t&&i<1&&(i=tt.PLAYBACK_RATE_MAX),e.rate=i,tt._lsSet(tt.LS_PODCASTS,e),J=e,this._updatePlaybackRate()}playAudio(t){var e=new AudioPlaylist(AudioPlaylist.TYPE_TEMP);e.mergeWith({list:[t]}),this.play(t,e)}}tt.UNAUTH_FADE_TIME=.8,tt.LS_VER="v20",tt.LS_KEY_PREFIX="audio",tt.LS_PREFIX=tt.LS_KEY_PREFIX+"_"+tt.LS_VER+"_",tt.LS_STATUS_EXPORT=tt.LS_KEY_PREFIX+"_status_export",tt.LS_VOLUME="vol",tt.LS_PL="pl",tt.LS_TRACK="track",tt.LS_SAVED="saved",tt.LS_PROGRESS="progress",tt.LS_PODCASTS="podcasts",tt.LS_DURATION_TYPE="dur_type",tt.LS_UUID="uuid",tt.LS_ADS_CURRENT_DELAY="ads_current_delay_v4",tt.PLAYBACK_RATE_STEP=.5,tt.PLAYBACK_RATE_MAX=3;var et=window.devicePixelRatio>=2?"_2x":"";function it(t,e,i){var a=t.getContext("2d");a.clearRect(0,0,t.width,t.height),a.fillStyle=i?"#3D6899":"#ffffff";for(var s=0;s<4;s++){var o=2+12*e[s];a.fillRect(13+4*s,12-o+14,2,o)}}function at(){window.AudioLayer=a.default,window.AudioUtils=s.AudioUtils,window.TopAudioPlayer=d,window.AudioPlaylist=u.AudioPlaylist,window.AudioPlayer=tt}tt.tabIcons={def:`/images/icons/favicons/fav_logo${et}.ico`,play:`/images/icons/favicons/fav_play${et}.ico`,pause:`/images/icons/favicons/fav_pause${et}.ico`}},D33C:function(__webpack_module__,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"AudioPlaylist",(function(){return AudioPlaylist}));var core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("a1Th"),core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("Btvt"),core_js_modules_es6_array_from__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("HEwt"),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("rGqo"),core_js_modules_es7_symbol_async_iterator__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("rE2o"),core_js_modules_es6_symbol__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("ioFf"),core_js_modules_es6_regexp_search__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("OG14"),core_js_modules_es6_array_sort__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("Vd3H"),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("pIFo"),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("KKXr"),_shared_lib_common__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("jE6c"),_utils__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("pp2G"),_playlist_loadAllPlaylistAudios__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("PMB/");function _toArray(t){return _arrayWithHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(i):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,a=new Array(e);i<e;i++)a[i]=t[i];return a}function _iterableToArray(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function _arrayWithHoles(t){if(Array.isArray(t))return t}class AudioPlaylist{static splitId(t){var e=_toArray(t.split("_")),i=e[0],a=e[1],s=e.slice(2);return[i,a,s=s.join("_")]}constructor(t,e,i){getAudioPlayer().addPlaylist(this);var a={};if(t&&Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_10__.isFunction)(t.getId))return this._ref=t,void getAudioPlayer().addPlaylist(this);isObject(t)?a=t:(a.ownerId=e,a.type=t,a.albumId=i||++AudioPlaylist.plIndex),this._type=a.type,this._ownerId=a.ownerId||vk.id,this._albumId=a.albumId||0,this._fromId=a.fromId||0,this._list=[],this._context=a.context||"",this._blockId=a.blockId,this._nextOffset=a.nextOffset,this.mergeWith(a)}updatePlaylist(t){var e=this.getSelf(),i=!1;return e&&t?(e._title!==t.title&&(e._title=t.title,i=!0),e._titleLang!==t.titleLang&&(e._titleLang=t.titleLang,i=!0),i):i}getId(){return this.getType()+"_"+this.getOwnerId()+"_"+this.getAlbumId()}getFullId(){return this.getOwnerId()+"_"+this.getAlbumId()+(this.getAccessHash()?"_"+this.getAccessHash():"")}isReference(){return!!this._ref}getSelf(){return this._ref&&isObject(this._ref)?this._ref:this}getType(){return this.getSelf()._type}getOwnerId(){return+this.getSelf()._ownerId}getAlbumId(){return this.getSelf()._albumId}getPlaylistId(){return this.getSelf()._albumId}getOriginalPlaylistRawId(){return this.getSelf()._originalPlaylistRawId}getFollowHash(){return this.getSelf()._followHash}getContext(){return this.getSelf()._context}getRawId(){return this.getSelf()._rawId}getGridCovers(){return this.getSelf()._gridCovers||""}getTitle(){return this.getSelf()._title||""}getTitleLang(){return this.getSelf()._titleLang||""}getSubtitle(){return this.getSelf()._subTitle||""}getDescription(){return this.getSelf()._description||""}getRawDescription(){return this.getSelf()._rawDescription||""}getAccessHash(){return this.getSelf()._accessHash||""}getFromId(){return this.getSelf()._fromId||0}getAuthorLine(){return this.getSelf()._authorLine||""}getAuthorHref(){return this.getSelf()._authorHref||""}getAuthorName(){return this.getSelf()._authorName||""}getInfoLine1(){return this.getSelf()._infoLine1||""}getInfoLine2(){return this.getSelf()._infoLine2||""}getListens(){return this.getSelf()._listens||0}getAddClasses(){return this.getSelf()._addClasses||""}getLastUpdated(){return this.getSelf()._lastUpdated||""}getEditHash(){return this.getSelf()._editHash||""}getDeleteHash(){return this.getSelf()._deleteHash||""}getReplaceHash(){return this.getSelf()._replaceHash||""}getCoverUrl(){return this.getSelf()._coverUrl||""}getBlocks(){return this.getSelf()._blocks||{}}getFeedFrom(){return this.getSelf()._feedFrom}getFeedOffset(){return this.getSelf()._feedOffset}getSearchParams(){return this.getSelf()._searchParams||null}getSearchQid(){return this.getSelf()._searchQid||null}getLocalFoundCount(){return this.getSelf()._localFoundTotal||0}getTotalCount(){return this.getSelf()._totalCount}getTotalCountHash(){return this.getSelf()._totalCountHash}getShuffle(){return this.getSelf()._shuffle}getFriendId(){return this.getSelf()._friend}getNextOffset(){var t=this.getSelf();return t._forceReload?(t._forceReload=!1,0):""===t._nextOffset?t._nextOffset:t._nextOffset||this.getAudiosCount()}getAudiosList(){return this.getSelf()._list||[]}getUnshuffledAudiosList(){var t=this.getSelf();return t._originalList?t._originalList:t._list}getItemsList(){return this.getSelf()._items||[]}getPostId(){return this.getSelf()._postId}getWallQuery(){return this.getSelf()._wallQuery}getWallType(){return this.getSelf()._wallType}getCommunititesBlock(){return this.getSelf()._communitiesBlock}getArtistsBlock(){return this.getSelf()._artistsBlock}getPlaylistsBlock(){return this.getSelf()._playlistsBlock}getLiveInfo(){var t=this.getSelf()._live;return!!t&&{hostId:(t=t.split(","))[0],audioId:t[1],hash:t[2]}}getAudioAt(t){var e=this.getSelf();return Array.isArray(e._list)&&e._list.length>t?e._list[t]:null}getAudiosCount(){var t=this.getSelf();return Array.isArray(t._list)?t._list.length:0}getTotalDuration(){var t=this.getAudiosList(),e=0;return each(t,(function(t,i){e+=i[_utils__WEBPACK_IMPORTED_MODULE_11__.AudioUtils.AUDIO_ITEM_INDEX_DURATION]})),e}getItemsCount(){var t=this.getSelf();return t._items=t._items||[],t._items.length}setForceReload(t){this.getSelf()._forceReload=t}setLocalFoundCount(t){this.getSelf()._localFoundTotal=t}setAdsAllowed(t){return this.getSelf()._isAdsAllowed=t}setFollowed(t){var e=this.getAddClasses()||"";return e=e.replace("audio_playlist__followed",""),t&&(e+=" audio_playlist__followed"),this.getSelf()._addClasses=e,this.getSelf()._isFollowed=t}isBlocked(){return!!this.getSelf()._isBlocked}hasMore(){return!!this.getSelf()._hasMore}isOfficial(){return!!this.getSelf()._isOfficial}isFollowed(){return this.getSelf()._isFollowed}isShuffled(){return!!this.getShuffle()}isAdsAllowed(){return!!this.getSelf()._isAdsAllowed}isInitedSortedList(){return!!this.getSelf()._sorted}isFullyLoadable(){return this.getType()===AudioPlaylist.TYPE_PLAYLIST}isLive(){return!!this.getLiveInfo()}_unref(){var t=this._ref;if(isObject(t)){var e={};for(var i in t)if(t.hasOwnProperty(i)&&!Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_10__.isFunction)(t[i])&&0===i.indexOf("_")){var a=t[i];e[i.substr(1)]=isObject(a)?clone(a):a}e.hasMore=!1,delete this._ref,this._type=AudioPlaylist.TYPE_TEMP,this._ownerId=e.ownerId||vk.id,this._albumId=AudioPlaylist.plIndex++,this._list=[],this.mergeWith(e)}}equals(t){return this.getSelf()===t.getSelf()}serialize(){return JSON.stringify(this.asObject())}asObject(){var t={},e=getAudioPlayer().getCurrentAudio(),i=Math.max(0,this.indexOfAudio(e));return t.list=clone(this.getAudiosList().slice(Math.max(0,i-100),i+300),!0),each(t.list,(function(t,e){e[_utils__WEBPACK_IMPORTED_MODULE_11__.AudioUtils.AUDIO_ITEM_INDEX_URL]=""})),t.type=AudioPlaylist.TYPE_TEMP,t.ownerId=vk.id,t.albumId=this.getAlbumId(),t.accessHash=this.getAccessHash(),t.hasMore=!1,t.title=this.getTitle(),t.titleLang=this.getTitleLang(),t.context=getAudioPlayer()._getPlayingContext(),t.originalPlaylistRawId=this.getOriginalPlaylistRawId(),this.getType()===AudioPlaylist.TYPE_PLAYLIST&&this.getAlbumId()>0&&(t.originalPlaylistRawId=this.getOwnerId()+"_"+this.getAlbumId()+"_"+this.getAccessHash()),t}asPlaylistData(){return{type:this.getType(),ownerId:this.getOwnerId(),id:this.getId(),title:this.getTitle(),hasMore:this.hasMore(),list:this.getAudiosList(),nextOffset:this.getNextOffset(),subtitle:this.getSubtitle(),totalCount:this.getTotalCount(),blockId:this.getBlockId()}}toString(){return this.getId()}_moveCurrentAudioAtFirstPosition(){var t=getAudioPlayer().getCurrentAudio(),e=this.getSelf(),i=this.indexOfAudio(t);-1!==i&&(e._list.splice(i,1),e._list.unshift(t),e._movedAudioToFirstPos=i)}_resetMovedAudioToInitialPosition(){var t=this.getSelf();if(t._movedAudioToFirstPos){var e=t._list.splice(0,1);t._list.splice(t._movedAudioToFirstPos,0,e[0]),delete t._movedAudioToFirstPos}}_ensureIndex(t){var e=this.getSelf();if(e._index)t&&t();else{var i=function(t,e){var i=intval(e);return i>=33&&i<48?String.fromCharCode(i):t};e._index=new vkIndexer(e._list,(function(t){return(t[_utils__WEBPACK_IMPORTED_MODULE_11__.AudioUtils.AUDIO_ITEM_INDEX_PERFORMER]+" "+t[_utils__WEBPACK_IMPORTED_MODULE_11__.AudioUtils.AUDIO_ITEM_INDEX_TITLE]).replace(/\&\#(\d+);?/gi,i)}),t)}}clean(t){t||this._unref();var e=this.getSelf();e._hasMore=!0,e._list=[],e._items=[],e._feedOffset=e._feedFrom=0,e._nextOffset=0}cleanIndex(){this.getSelf()._index=null}initSortedList(t){if(!Array.isArray(t))return!1;var e=this.getSelf();e._originalList||(e._originalList=[].concat(e._list)),e._sorted=!0,e._list=t}removeSortedList(){var t=this.getSelf();t._originalList&&(t._list=[].concat(t._originalList)),t._sorted=!1}shuffle(t,e){if(!(this.isShuffled()&&t||!this.isShuffled()&&!t)){var i=this.getSelf(),a=!1;if(delete i._sorted,t){var s;if(!this.hasMore()||this.getBlockId())i._originalList=i._originalList||[].concat(i._list),shuffle(i._list),e||this._moveCurrentAudioAtFirstPosition(),s=!0;else if(this.getType()===AudioPlaylist.TYPE_SEARCH)i._originalList=i._originalList||[].concat(i._list),shuffle(i._list),e||this._moveCurrentAudioAtFirstPosition(),s=!0;else if(inArray(this.getType(),[AudioPlaylist.TYPE_RECOM])){var o=getAudioPlayer().getCurrentAudio(),l=this.indexOfAudio(o);this.clean(!0),l>=0&&i.addAudio(o,0),s=!0,a=!0}else this._unref(),(i=this.getSelf())._originalList=i._originalList||[].concat(i._list),shuffle(i._list),e||this._moveCurrentAudioAtFirstPosition(),s=!0;s&&(i._shuffle=t)}else i._originalList?i._list=i._originalList:this.clean(!0),a=!0,delete i._shuffle,delete i._originalList;return a&&this.load(this.getNextOffset()),!0}}getNextAudio(t,e){if(!t)return!!(t=this.getAudioAt(0))&&(e&&_utils__WEBPACK_IMPORTED_MODULE_11__.AudioUtils.asObject(t).isClaimed?this.getNextAudio(t,!0):t);var i=this.indexOfAudio(t);if(i<0)return!1;if(i+1<this.getAudiosCount()){var a=this.getAudioAt(i+1);return e&&_utils__WEBPACK_IMPORTED_MODULE_11__.AudioUtils.asObject(a).isClaimed?this.getNextAudio(a,!0):a}return!1}removeAudio(t){var e=this.indexOfAudio(t);if(e>=0){this._unref();var i=this._list.splice(e,1);return this._index&&this._index.remove(i[0]),e}return-1}addAudio(t,e){this._unref();var i=void 0===e,a=t=>{var a=this.getUnshuffledAudiosList(),s=this.indexOfAudio(t);if(s>=0){if(i)return;a.splice(s,1)}(t=clone(t))[_utils__WEBPACK_IMPORTED_MODULE_11__.AudioUtils.AUDIO_ITEM_INDEX_TITLE]=clean(replaceEntities(t[_utils__WEBPACK_IMPORTED_MODULE_11__.AudioUtils.AUDIO_ITEM_INDEX_TITLE]).replace(/(<em>|<\/em>)/g,"")),t[_utils__WEBPACK_IMPORTED_MODULE_11__.AudioUtils.AUDIO_ITEM_INDEX_PERFORMER]=clean(replaceEntities(t[_utils__WEBPACK_IMPORTED_MODULE_11__.AudioUtils.AUDIO_ITEM_INDEX_PERFORMER]).replace(/(<em>|<\/em>)/g,"")),i?a.push(t):a.splice(e,0,t),this._index&&this._index.add(t)};if(isArray(t)&&isArray(t[0]))for(var s=0,o=t.length;s<o;s++)a(t[s]);else t&&t.length&&a(t)}moveAudio(t,e){this._unref();var i=this._list.splice(t,1);t<e&&(e-=1),this._list.splice(e,0,i[0])}indexOfAudio(t){if(!t)return-1;var e;isString(t)?e=t.split("_"):isObject(t)?e=[t.ownerId,t.id]:isArray(t)&&(e=[t[_utils__WEBPACK_IMPORTED_MODULE_11__.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID],t[_utils__WEBPACK_IMPORTED_MODULE_11__.AudioUtils.AUDIO_ITEM_INDEX_ID]]);var i=this.getSelf()._list;if(!i)return-1;for(var a=0,s=i.length;a<s;a++)if(i[a]&&e[0]==i[a][_utils__WEBPACK_IMPORTED_MODULE_11__.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]&&e[1]==i[a][_utils__WEBPACK_IMPORTED_MODULE_11__.AudioUtils.AUDIO_ITEM_INDEX_ID])return a;return-1}getAudio(t){if(!t)return null;var e=this.getSelf();t=t.split("_");for(var i=0,a=e._list.length;i<a;i++)if(t[0]==e._list[i][_utils__WEBPACK_IMPORTED_MODULE_11__.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]&&t[1]==e._list[i][_utils__WEBPACK_IMPORTED_MODULE_11__.AudioUtils.AUDIO_ITEM_INDEX_ID])return e._list[i];return null}getBlockId(){return this.getSelf()._blockId}loadAll(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!this.isFullyLoadable())return t&&t();this.load(0,t,!0,"default",e)}loadByBlockId(t,e,i){var a=this,s=(arguments.length>3&&void 0!==arguments[3]&&arguments[3],function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=a._onDoneLoading;delete a._onDoneLoading,delete a._loadingAll,each(i||[],(t,i)=>{i&&i(a,e)})}),o=this.getNextOffset();return this.getAudiosCount()&&t!==o?e&&e(this):(this._onDoneLoading=this._onDoneLoading||[],this._onDoneLoading.push(e),this._loadingAll?void 0:i?(this._loadingAll=!0,void Object(_playlist_loadAllPlaylistAudios__WEBPACK_IMPORTED_MODULE_12__.loadAllPlaylistAudios)(this,s)):void ajax.post("al_audio.php?act=load_block_playlist",{block_id:this._blockId,start_from:o},{onDone:t=>{var e=getAudioPlayer();e.mergePlaylistData(this,t),s(this),e.saveStateCurrentPlaylist(),""===this.getNextOffset()&&(clearTimeout(this._sendSearchStatsTimeout),this._sendSearchStatsTimeout=setTimeout(this.sendSearchStats.bind(this,"search_view"),3e3),this._searchPlayStatsSent=!1)}}))}load(offset,_onDone,needAll){var trackType=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"default",viewType=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_10__.isFunction)(offset)?(_onDone=offset,offset=0):offset=intval(offset);var searchParams=this.getSearchParams(),wasPreload=!1,countAvailable=this.getType()===AudioPlaylist.TYPE_FEED?this.getItemsCount():this.getAudiosCount(),isGoingToLoadAll=this.isFullyLoadable()&&needAll&&this.hasMore(),callOnDones=(t,e,i)=>{var a=this._onDoneLoading;i||(delete this._onDoneLoading,delete this._loadingAll),(!wasPreload||wasPreload&&cur.audioChooseBox&&curBox())&&each(a||[],(t,i)=>{this.cleanIndex(),i&&i(this,e)}),i&&(wasPreload=!0)};if(offset<countAvailable&&!isGoingToLoadAll||""===this.getNextOffset()||!this.hasMore()||searchParams&&this.getType()===AudioPlaylist.TYPE_SEARCH&&!searchParams.globalQuery)return _onDone&&_onDone(this);if(this._onDoneLoading=this._onDoneLoading||[],this._onDoneLoading.push(_onDone),!this._loadingAll){if(needAll)return this._loadingAll=!0,void Object(_playlist_loadAllPlaylistAudios__WEBPACK_IMPORTED_MODULE_12__.loadAllPlaylistAudios)(this,callOnDones,viewType);var params;offset=this.getNextOffset(),offset===this.getLocalFoundCount()&&(offset-=this.getLocalFoundCount()),offset||clearTimeout(this._sendSearchStatsTimeout);var isCatalog=!1;if(this._blockId)params={act:"load_block_playlist",block_id:this._blockId,start_from:this.getNextOffset()},isCatalog=!0;else{var ownerId=cur.audioPage&&this.getType()===AudioPlaylist.TYPE_SEARCH?cur.audioPage.getOwnerId():this.getOwnerId();params={act:"load_section",type:this.getType(),owner_id:ownerId,playlist_id:this.getPlaylistId(),offset,access_hash:this.getAccessHash(),search_q:searchParams?searchParams.globalQuery:null,search_performer:searchParams?searchParams.performer:null,search_lyrics:searchParams?searchParams.lyrics:null,search_sort:searchParams?searchParams.sort:null,search_history:searchParams?intval(searchParams.fromHistory):null,search_qid:this.getSearchQid(),feed_from:this.getFeedFrom(),feed_offset:this.getFeedOffset(),shuffle:this.getShuffle(),post_id:this.getPostId(),wall_query:this.getWallQuery(),wall_type:this.getWallType(),claim:intval(nav.objLoc.claim),track_type:trackType}}ajax.post("al_audio.php",params,{onDone:(loadedPlaylist,tpl,langs,templatesScript,data)=>{if(!loadedPlaylist)return this.getSelf()._nextOffset="",void(isCatalog?_onDone&&_onDone(loadedPlaylist):callOnDones());if(addTemplates({audio_playlist_snippet:tpl}),extend(cur.lang,langs),templatesScript&&eval(templatesScript),!this._loadingAll||needAll){var audioPlayer=getAudioPlayer();audioPlayer.mergePlaylistData(this,loadedPlaylist),isCatalog?_onDone&&_onDone(loadedPlaylist.list):callOnDones(),audioPlayer.saveStateCurrentPlaylist(),offset&&""!==loadedPlaylist.nextOffset||(clearTimeout(this._sendSearchStatsTimeout),this._sendSearchStatsTimeout=setTimeout(this.sendSearchStats.bind(this,"search_view"),3e3),this._searchPlayStatsSent=!1)}},onFail:()=>!0,cache:this.getType()===AudioPlaylist.TYPE_SEARCH?1:0})}}mergeWith(t){if(!isObject(this._ref)){if(t.list&&this.addAudio(t.list),t.items){this._items=this._items||[];for(var e=0,i=t.items.length;e<i;e++)this._items.push(t.items[e])}this._albumId=t.id||this._albumId;each(["accessHash","addClasses","artistsBlock","authorLine","authorHref","authorName","communitiesBlock","coverUrl","description","gridCovers","editHash","feedFrom","feedOffset","followHash","hasMore","infoLine1","infoLine2","isAdsAllowed","isFollowed","isOfficial","isBlocked","lastUpdated","listens","live","nextOffset","originalList","ownerId","playlistsBlock","postId","rawId","rawDescription","searchQid","searchParams","shuffle","subTitle","title","titleLang","totalCount","totalCountHash","type","wallQuery","wallType"],(e,i)=>{void 0!==t[i]&&(this["_"+i]=t[i])})}}search(t,e){var i=this.getSelf();isObject(t)||(t={q:t}),this._ensureIndex(()=>{var a=i._index?i._index.search(t.q):[];return a=a.filter((function(e){return!t.lyrics||!!intval(e[_utils__WEBPACK_IMPORTED_MODULE_11__.AudioUtils.AUDIO_ITEM_INDEX_LYRICS])})),e(a)})}sendSearchStats(t){if("search_play"===t){if(this._searchPlayStatsSent)return;this._searchPlayStatsSent=!0}ajax.post("al_audio.php?act=search_stats",{event_type:t,search_type:this.getSearchQid()?"external":"internal",search_params:JSON.stringify(this.getSearchParams()),results_count:this.getTotalCount()})}fetchNextLiveAudio(t){var e=this.getLiveInfo();ajax.post("al_audio.php",{act:"a_get_audio_status",host_id:e.hostId,hash:e.hash},{onDone:e=>{if(e){var i=this.indexOfAudio(e);i>=0?this.moveAudio(i,this.getAudiosCount()-1):this.addAudio(e)}t&&t(e)},onFail:()=>!0})}}AudioPlaylist.plIndex=0,AudioPlaylist.TYPE_CURRENT="current",AudioPlaylist.TYPE_PLAYLIST="playlist",AudioPlaylist.TYPE_MY="my",AudioPlaylist.TYPE_ALBUM="album",AudioPlaylist.TYPE_TEMP="temp",AudioPlaylist.TYPE_RECOM="recoms",AudioPlaylist.TYPE_SEARCH="search",AudioPlaylist.TYPE_FEED="feed",AudioPlaylist.TYPE_LIVE="live",AudioPlaylist.TYPE_WALL="wall",AudioPlaylist.TYPE_RECENT="recent",AudioPlaylist.DEFAULT_PLAYLIST_ID=-1},Oupy:function(t,e,i){"use strict";function a(t,e,i,a){stManager.add([jsc("web/audio.js"),"audio.css",jsc("web/auto_list.js")],(function(){ajax.post("al_audio.php?act=playlists_edit_data",{owner_id:t},{onDone:function(s){s.audio_playlist_cover_upload_options&&(cur.audioCoverUploadOptions=cur.audioCoverUploadOptions||{},cur.audioCoverUploadOptions[t]=s.audio_playlist_cover_upload_options),AudioPage.editPlaylist(t,e,i,a)},onFail:()=>!0})}))}i.r(e),i.d(e,"editPlaylist",(function(){return a}))},"PMB/":function(__webpack_module__,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"loadAllPlaylistAudios",(function(){return loadAllPlaylistAudios}));var AUDIO_LOAD_CHUNK_SIZE=1e3,chunks,isDeleted,isAttach,onDone,playlist,preloadedCount,totalCount=void 0;function loadAllPlaylistAudios(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!t.hasMore()||!t.isFullyLoadable())return onDone&&onDone();chunks=[],isAttach="attach"===i,onDone=e,playlist=t,preloadedCount=0,totalCount=t.getTotalCount(),loadChunk(0,()=>{isDeleted?onAllLoaded():(isAttach&&onAllLoaded(),loadAllChunks(onAllLoaded,1))})}function onAllLoaded(){if(isDeleted)return onDone&&onDone(null,isDeleted);var t=[];(each(chunks,(function(e,i){i&&(t=t.concat(i))})),getAudioPlayer().getPlaylists().forEach(e=>{e.getId()===playlist.getId()&&(e._list=t,e._unref())}),getAudioPlayer().mergePlaylistData(playlist,{hasMore:!1}),onDone)&&onDone(playlist,!1,isAttach&&totalCount>preloadedCount)}function loadAllChunks(t,e){e=e||0;var i=Math.max(0,Math.ceil((totalCount-preloadedCount)/AUDIO_LOAD_CHUNK_SIZE));isAttach&&e&&totalCount>preloadedCount&&i===e&&i++,i-e<=0?t():function(){for(var a=new CallHub(t,i-e),s=e;s<i;s++)loadChunk(s,()=>{a.done()})}()}function loadChunk(chunkIndex,callback){var isPreload=isAttach&&!chunkIndex?1:0,offset=chunkIndex*AUDIO_LOAD_CHUNK_SIZE;preloadedCount&&(offset=Math.abs(AUDIO_LOAD_CHUNK_SIZE-preloadedCount-chunkIndex*AUDIO_LOAD_CHUNK_SIZE)),ajax.post("al_audio.php?act=load_section",{type:playlist.getType(),owner_id:playlist.getOwnerId(),playlist_id:playlist.getPlaylistId(),access_hash:playlist.getAccessHash(),from_id:playlist.getFromId(),offset,is_loading_all:1,is_preload:isPreload,context:playlist.getContext(),claim:intval(nav.objLoc.claim)},{onDone:function onDone(data,tpl,langs,templatesScript){if(0===chunkIndex){if(addTemplates({audio_playlist_snippet:tpl}),extend(cur.lang,langs),templatesScript&&eval(templatesScript),!data)return isDeleted=!0,callback();totalCount=data.totalCount,preloadedCount=data.list.length,getAudioPlayer().mergePlaylistData(playlist,data)}chunks[chunkIndex]=data.list,callback()},onFail:()=>!0})}},"Se/q":function(t,e,i){"use strict";i.r(e),i.d(e,"removeFromGroup",(function(){return s}));var a=i("zxIV");function s(t,e,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=t+"_"+e;if(cur.audioPage._ownerId<0)var l=window.showBox("al_audio.php",{act:"delete_from_group_box",playlist_id:o,group_id:-cur.audioPage._ownerId}).setButtons(getLang("global_yes"),()=>{ajax.post("al_audio.php",{act:"delete_from_group",group_id:-cur.audioPage._ownerId,hash:i,playlist_id:o},{onDone(t){if(l.hide(),showDoneBox(t),s){var e=Object(a.gpeByClass)("audio_pl_snippet2",s);e&&e.classList.remove("audio_pl__can_remove_from_club")}},onFail:t=>(l.hide(),showDoneBox(t),!0)})},getLang("global_cancel"),()=>l.hide()).show()}},fY4C:function(t,e,i){"use strict";i.r(e),i.d(e,"WebPlayerAdapter",(function(){return r}));var a=i("XLUH"),s=i("pp2G"),o=i("zxIV"),l=i("C13D");class r extends a.AudioStatsPlayerAdapter{getPausedBy(t){var e=this.player,i=e.pausedByVideo,a=e.pausedByStories,s=e.pausedByAudio,o=e.pausedByQueue;return i&&t<i||window.Videoview&&Videoview.isLayerShown()?"video":a&&t<a||window.cur&&cur.storyLayer?"stories":s&&t<s?"audio":o&&t<o?"queue":null}getState(){var t=super.getState(),e=this.getAudioId();if(e){var i=Object(o.geByClass)("_audio_row_"+e+" audio_row__current",Object(o.ge)("page_layout"));if(i&&i.length)return a.FULL_SCREEN_STATE}return t}getAudio(){return Object(l.asObject)(this.player.getCurrentAudio())}getProgress(){return this.player.getCurrentProgress()}getProgressInSeconds(){var t=this.player.getCurrentAudio();return t?Math.round(this.player.getCurrentProgress()*t[s.AudioUtils.AUDIO_ITEM_INDEX_DURATION]):0}getVolume(){return Math.round(100*(t=this.player.getVolume(),Math.log(1+34*t)/Math.log(35)));var t}getAudioId(){var t=this.player.getCurrentAudio();if(t)return t[s.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+t[s.AudioUtils.AUDIO_ITEM_INDEX_ID]}getAudioTrackCode(){var t=this.player.getCurrentAudio();if(t)return t[s.AudioUtils.AUDIO_ITEM_INDEX_TRACK_CODE]}getPrevAudioId(){var t=this.player._prevAudio;if(t)return t[s.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+t[s.AudioUtils.AUDIO_ITEM_INDEX_ID]}getPrevPlaylistId(){var t=this.player._prevPlaylist;if(t)return t.getFullId()}getPlaylistId(){var t=this.player.getCurrentPlaylist();if(t)return t.getFullId()}getContext(){return this.player._getPlayingContext()}getSequence(){return this.player._seq}getType(){if(this.player._impl)return this.player._impl.type}getSearchParams(){var t=this.player.getCurrentPlaylist();if(t)return t.getSearchParams()}isShuffledPlaylist(){var t=this.player.getCurrentPlaylist();if(t)return t.isShuffled()}isRealPlaylist(){var t=this.player.getCurrentPlaylist();return!!t&&t.getType()===AudioPlaylist.TYPE_PLAYLIST}isRealPrevPlaylist(){var t=this.player._prevPlaylist;return!!t&&t.getType()===AudioPlaylist.TYPE_PLAYLIST}isPodcast(){var t=this.player.getCurrentAudio();return s.AudioUtils.isPodcast(t)}isLastTrack(){var t=this.player.getCurrentAudio(),e=this.player.getCurrentPlaylist();return!!t&&(!(!t||e)||e.indexOfAudio(t)+1===e.getAudiosCount())}hasPlaylist(){return Boolean(this.player.getCurrentPlaylist())}hasSearchParams(){return this.getContext()===AudioPlaylist.TYPE_SEARCH}isDebug(){return Boolean(ls.get(AudioPlayer.LS_PREFIX+"stats_debug"))}sendListenedData(t){var e=this.player.getListenedHash();!e&&window.cur&&cur.audioPage&&(e=cur.audioPage._data.listenedHash);var i=extend({act:"listened_data",impl:this.getType(),hash:e,v:5,loc:nav.strLoc},t);isArray(cur.audioLoadTimings)&&(i.timings=cur.audioLoadTimings.join(","),cur.audioLoadTimings=[]),ajax.post("al_audio.php",i,{onDone:t=>{this.player._adsConfig=t},onFail:()=>!0})}}},lXup:function(t,e,i){"use strict";i.r(e),i.d(e,"getContextPlaylist",(function(){return l}));i("HEwt"),i("a1Th"),i("Btvt"),i("rGqo"),i("rE2o"),i("ioFf"),i("pIFo"),i("KKXr");var a=i("zxIV");function s(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],a=!0,s=!1,o=void 0;try{for(var l,r=t[Symbol.iterator]();!(a=(l=r.next()).done)&&(i.push(l.value),!e||i.length!==e);a=!0);}catch(t){s=!0,o=t}finally{try{a||null==r.return||r.return()}finally{if(s)throw o}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return o(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(i);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return o(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,a=new Array(e);i<e;i++)a[i]=t[i];return a}function l(t,e){var i=getAudioPlayer(),o=AudioUtils.getAudioFromEl(t,!0);if(o){var l=null,r=[],d=Object(a.domData)(t,"new-post"),n=!1,u=null,_=AudioPlaylist.TYPE_TEMP,c=vk.id,h=null,p={},g=window.AudioPage&&currentAudioPage(t);if((window.traverseParent||function(t,e){for(t=Object(a.ge)(t);t&&!e(t)&&(t=Object(a.domPN)(t))!=document;);return null})(t,t=>n=Object(a.domData)(t,"audio-context")),n=(n=o.context||n)||("audio"==cur.module?cur.submodule:cur.module),e)return{context:n};var A=s(AudioUtils.contextSplit(n),2),y=A[0],f=A[1],v=Object(a.gpeByClass)("_audio_pl",t);if(v){var P=Object(a.domData)(v,"playlist-id");(u=i.getPlaylistByBlockId(P))||(u=i.getPlaylist(...AudioPlaylist.splitId(P||"")));var b=Object(a.domData)(v,"title")||"";b&&u.mergeWith({title:clean(b)});var m=Object(a.domData)(v,"access-hash")||"";m&&u.mergeWith({accessHash:m});var E=g&&g.getPageCurrentPlaylist(),O=i.getCurrentPlaylist();E&&E.equals(u)&&O&&i.getCurrentPlaylist().getFullId()===E.getFullId()&&g.getSortedList()?u.initSortedList(g.getSortedList()):o.isFromCurrentPlaylist||(g&&g.clearSortedList(),u.removeSortedList(),u.shuffle(0))}else if(g&&g.getPageCurrentPlaylist())u=g.getPageCurrentPlaylist();else if("module"==y){var I=f;u=i.getPlaylist(AudioPlaylist.TYPE_PLAYLIST,I||cur.oid||vk.id,AudioPlaylist.DEFAULT_PLAYLIST_ID),r=[l]}else if(0===o.context.indexOf("admin"))(u=i.getPlaylist(AudioPlaylist.TYPE_PLAYLIST,o.ownerId,0,o.accessKey)).getAudiosCount()||u.setForceReload(!0);else if(0===o.context.indexOf("im"))l=(l=Object(a.gpeByClass)("_im_peer_history",t))||Object(a.gpeByClass)("_fc_tab_log_msgs",t),h="im"+(cur.peer||"");else if(0===o.context.indexOf("board"))h=o.context,r=S(Object(a.geByClass)("_wall_audio_rows",l));else if(0===o.context.indexOf("widget"))h=o.context;else if(0===o.context.indexOf("wiki"))h="wiki";else if(0===o.context.indexOf("post")){_=AudioPlaylist.TYPE_WALL,h=o.context;var w=o.context.replace("post","").split("_");c=w[0],p={postId:w[1]}}else if(0===o.context.indexOf("choose"))h=o.context;else if("feed"==d||0===o.context.indexOf("feed")||0===o.context.indexOf("feedsearch"))h="feed",r=S(Object(a.geByClass)("wall_text",l));else if("group_wall"==y||"user_wall"==y||0===o.context.indexOf("reply")||"wall"==d){_=AudioPlaylist.TYPE_WALL,c=cur.oid;var C=(f||"").split("_")[1],U=cur.wallQuery||"",T=Object(a.ge)("wall_search"),L=inArray(cur.wallType,["own","full_own"])?"own":"all";h=hashCode(L+"_"+U),"wall"==cur.module&&Object(a.val)(T)&&(U=Object(a.val)(T)),C&&(p={postId:C,wallQuery:U,wallType:L}),0===o.context.indexOf("reply")&&(r=S([Object(a.gpeByClass)("_replies_list",t)]),h="reply"+h),r=r.concat(S([l]))}else"article"==y&&(u=cur.articlePlaylist);return l||(l=Object(a.domPN)(t)),(r=r.filter((function(t){return!!t})))&&0!=r.length||(r=[l]),(u=(u=u||i.getPlaylist(_,c,h)).getAudiosCount()?u:AudioUtils.initDomPlaylist(u,r)).mergeWith(p||{}),-1==u.indexOfAudio(o)&&(u=AudioUtils.initDomPlaylist(u,[Object(a.domPN)(t)])),{playlist:u,context:n}}function S(t){return[].slice.call(t)}}},pOqz:function(t,e,i){"use strict";i.r(e),i.d(e,"contextSplit",(function(){return a}));i("KKXr");function a(t){return isObject(t)&&(t=t.context),(t||"").split(":")}},pp2G:function(t,e,i){"use strict";i.r(e),i.d(e,"AudioUtils",(function(){return q}));var a={};i.r(a),i.d(a,"ACTION_PLAY",(function(){return x})),i.d(a,"ACTION_PAUSE",(function(){return R})),i.d(a,"ACTION_SEEK",(function(){return k})),i.d(a,"ACTION_HEARTBEAT",(function(){return M})),i.d(a,"ACTION_TIME_MARKER",(function(){return B})),i.d(a,"log",(function(){return N}));i("91GP");var s=i("uk5P");i("pIFo");var o=i("zxIV");var l=i("4bNW");i("KKXr");var r=i("6ng+"),d=i("5xrp");i("rGqo"),i("Btvt");var n=i("v+DW"),u=i("4+be"),_=i("BJj/");var c=i("t7n3"),h=i("EasH"),p=i("lXup");var g=i("pOqz"),A=i("ldAL");function y(t){return t&&t<=-2e9&&t>=-2002e6}function f(t,e,i){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s="";return s=y(t)?`/music/album/${t}_${e}${i?"_"+i:""}`:`/music/playlist/${t}_${e}`,a?`${location.protocol}//${location.host}${s}`:s}var v=i("Egk5");var P=i("Oupy"),b=[];function m(t,e){if(cur.audioPage&&isObject(t)){if(e){var i=cur.audioPage._data,a=i.playlists,s=i.playlistsIndex;Array.isArray(a)&&a.find(e=>e.id===t.id&&e.owner_id===t.owner_id)||(a&&(a.unshift(t),s.add(t)),cur.audioPage.updatePlaylistsCounter(vk.id))}cur.audioPage.requestUpdate(["all","playlists"],vk.id)}}var E=i("rEJs"),O=i("jE6c");var I=i("TGUg"),w=i("eVa8");function C(t){return t<600?"s":t<3600?"m":t<36e3?"l":"n"}function U(t,e){for(var i=JSON.parse(getTemplate("audio_bits_to_cls")),a=t[AudioUtils.AUDIO_ITEM_INDEX_FLAGS],s=[],o=0;o<32;o++){var l=1<<o;a&l&&s.push(i[l])}AudioUtils.isPodcast(t)&&(s.push("audio_podcast"),AudioUtils.isPrivatePodcast(t)&&s.push("audio_podcast_private")),e&&s.push(e);var r="";if(t[AudioUtils.AUDIO_ITEM_INDEX_COVER_URL]){var d=t[AudioUtils.AUDIO_ITEM_INDEX_COVER_URL].split(",");r="background-image: url("+d[0]+")"}var n,u=AudioUtils.getAudioPerformers(t),_=t[AudioUtils.AUDIO_ITEM_INDEX_DURATION],c=formatTime(_),h=clean(JSON.stringify(t));try{n=getTemplate("audio_row",t)}catch(t){return""}return n=(n=(n=(n=(n=(n=(n=n.replace(/%cls%/,()=>s.join(" "))).replace(/%duration%/,()=>c)).replace(/%serialized%/,()=>h)).replace(/%cover_style%/,()=>r)).replace(/%performers%/,()=>u)).replace(/%duration_mod%/,()=>C(_))).replace(/%position%/,()=>{return(e=t[AudioUtils.AUDIO_ITEM_CHART_INFO_INDEX]&&t[AudioUtils.AUDIO_ITEM_CHART_INFO_INDEX].position)?`<div class="audio_row__position">${e}</div>`:"";var e})}i("OEbY");var T=i("tWcy"),L=i("C13D");var S=i("Se/q"),D=i("wtP8"),j=i("W0fz");var x="play",R="pause",k="seek",M="heartbeat",B="time_marker";function N(t,e){var i=e.audio;AudioUtils.isPodcast(i)&&stManager.add([jsc("web/podcast.js")],(function(){Podcast.log(t,e)}))}var H=i("RbYe");var F=i("aong"),W=i("/PiP"),Y=i("XzvV");function K(t){Object(h.showFastBox)({hideButtons:!0,title:!1,containerClass:"audio_restriction_box",onHide:()=>{Object(Y.statlogsValueEvent)("audio_restriction_popup","hide",t.restrictionStatus)}},`\n    <button class="audio_restriction_box__close" onclick="curBox().hide()">${getLang("global_close")}</button>\n    <div class="audio_restriction_box__icon audio_restriction_box__icon_pensive_face"></div>\n    <div class="audio_restriction_box__title">${getLang("audio_restriction_title_claim")}</div>\n    <div class="audio_restriction_box__controls">\n        <button class="flat_button" onclick="curBox().hide()">${getLang("global_close")}</button>\n    </div>\n  `)}function X(t){var e=Object(o.geByClass)("_audio_row_"+t.fullId);if(!e||!e.length)return!1;var i=Object(F.parseJSON)(Object(o.domData)(e[0],"audio"));if(!i)return!1;var a=Object(F.parseJSON)(i[s.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_EXTRA]);a&&delete a.claim,i[s.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_RESTRICTION]=0,i[s.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FLAGS]&=~s.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_CLAIMED_BIT,i[s.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_EXTRA]=JSON.stringify(a);var l=Object(W.getAudioPlayer)().getCurrentPlaylist(),r=Object(o.se)(U(i,"no_extra"));if(l){var d=i[s.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+i[s.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ID],n=l.getAudio(d);n&&(n[s.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_RESTRICTION]=i[s.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_RESTRICTION],n[s.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FLAGS]=i[s.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FLAGS],n[s.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_EXTRA]=i[s.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_EXTRA])}return each(e,(t,e)=>{var a=t>0?Object(o.se)(U(i,"no_extra")):r;e.parentElement.insertBefore(a,e),e.parentElement.removeChild(e)}),r}function V(){return(V=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(t[a]=i[a])}return t}).apply(this,arguments)}function G(){return(G=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(t[a]=i[a])}return t}).apply(this,arguments)}var q=G({},s.AUDIO_PLAYER_ENUMS,{audioSearchPerformer:function(t,e,i){var a=!!window.AudioPage&&currentAudioPage(t),s=window.AudioPage&&currentAudioPage(t)||cur.audioPage;layers.fullhide&&layers.fullhide(!0),setTimeout((function(){a&&s?(e=unclean(e).replace(/<em>|<\/em>/g,""),nav.change({q:e,performer:1},i,{searchPerformer:!0,nav:!0,isLayer:a.isLayer()})):nav.go(t,i)}),50)},toggleAudioLyrics:function(t,e){var i=Object(o.geByClass1)("_audio_row__lyrics",t);if(i){if(Object(o.toggle)(i)){var a=Object(o.getSize)(t)[1],s=Object(o.getSize)(i)[1];Object(o.setStyle)(t,"height",a+s),Object(o.data)(t,"prevHeight",a)}else{var l=Object(o.data)(t,"prevHeight");Object(o.setStyle)(t,"height",l)}}else{Object(o.addClass)(t,"audio_loading");var r={act:"get_lyrics",aid:e.fullId,lid:e.lyrics};AudioUtils.isPodcast(e)&&(r.podcast=!0),ajax.post("al_audio.php",r,{onDone:function(a){Object(o.removeClass)(t,"audio_loading"),i=Object(o.se)(`<div class="_audio_row__lyrics audio_row__lyrics" data-nodrag="1" style="display:none;"><div class="audio_row__lyrics_inner">${a}</div></div>`),Object(o.geByClass1)("_audio_row_content",t).appendChild(i),AudioUtils.toggleAudioLyrics(t,e)},onFail:()=>!0})}},getRowActionName:function(t,e,i){var a,s=AudioUtils.getAddRestoreInfo();switch(t){case"current_delete":a=getLang("audio_delete_from_current");break;case"recoms_delete":a=getLang("audio_dont_show");break;case"listened_delete":a=getLang("audio_remove_from_list");break;case"delete":if(AudioUtils.isPodcast(e))a=getLang("audio_podcast_delete_episode");else if(window.AudioPage&&AudioPage.isInRecentPlayed(i))a=getLang("audio_remove_from_list");else{var o=s[e.fullId];a=o&&o.deleteAll?o.deleteAll.text:getLang("global_delete_audio")}break;case"restore_recoms":a=getLang("audio_restore_audio");break;case"more":a=getLang("global_media_selector_more");break;case"add":var l=s[e.fullId];if(AudioUtils.isPodcast(e))a=getLang("audio_podcast_restore_episode");else if(l&&"deleted"==l.state)a=getLang("audio_restore_audio");else if(l&&"added"==l.state)a=getLang("global_delete_audio");else{var r=!!window.AudioPage&&currentAudioPage(i);a=r&&r.getOwnerId()<0&&r.canAddToGroup()&&r.getOwnerId()!==e.ownerId?getLang("audio_add_to_group"):getLang("audio_add_to_audio")}break;case"edit":a=AudioUtils.isPodcast(e)?getLang("audio_podcast_edit_episode"):getLang("audio_edit_audio");break;case"next":a=cur.lang&&cur.lang.global_audio_set_next_audio||getLang("audio_set_next_audio");break;case"recoms":a=getLang("audio_show_recommendations");break;case"fave":a=AudioUtils.isPodcast(e)?getLang("audio_podcast_listen_later"):"";break;default:a=""}return a},initRowPlaylistsChooser:function(t,e,i){var a,s=AudioUtils.asObject(t);a=cur.audioPage&&cur.audioPage.getOwnerId()<0&&cur.audioPage.canEditGroup()?cur.audioPage.getOwnerId():vk.id,AudioUtils.playlistsByAudioDataCache=AudioUtils.playlistsByAudioDataCache||{};var o=AudioUtils.playlistsByAudioDataCache,l=a+"_"+s.ownerId+"_"+s.id;o[l]?AudioUtils._showPlaylistsChooser(i,e,o[l],a,s,t):ajax.post("al_audio.php",{act:"playlists_by_audio",owner_id:a,audio_owner_id:s.ownerId,audio_id:s.id},{onDone:(r,d,n)=>{var u=o[l]={playlists:r,morePlaylists:d,newPlaylistHash:n};AudioUtils._showPlaylistsChooser(i,e,u,a,s,t)},onFail:()=>!0})},addToPlaylistsBoxInit:function t(e,i,a,s,l){if("undefined"==typeof AutoList)return stManager.add(jsc("web/auto_list.js"),()=>{t(e,i,a,s,l)});var r=curBox(),d=Object(o.geByClass1)("_audio_atp_content",r.bodyNode),c=Object(o.geByClass1)("_audio_atp_list",r.bodyNode),h=Object(o.ge)("audio_atp_search"),p=Object(o.geByClass1)("_audio_atp_empty"),g=Object(o.getSize)(d)[1];Object(o.setStyle)(c,{height:g-Object(o.getSize)(h)[1]});var A,y="";function f(){A&&A.destroy(),c.innerHTML="";var t=[];t=y?s.filter(t=>t[2].toLowerCase().indexOf(y)>=0):s,Object(o.toggle)(c,0!=t.length),Object(o.toggle)(p,0==t.length),A=new AutoList(c,{onNeedRows:(e,i)=>{for(var a=[],s=i,o=Math.min(t.length,i+30),l=s;l<o;l++){var r=t[l];if(r){var d=`<div class="ape_pl_item _ape_pl_item ${r[4]?"ape_selected":""}" data-id="${r[1]}"><div class="ape_check"><div class="ape_check_icon"></div></div><div class="ape_pl_item_inner"><span class="ape_pl_title">${r[2]}</span> <span class="ape_pl_size">${r[3]}</span></div></div>`;a.push(d)}}e(a)}})}f(),cur.addToPlaylistSearch=Object(_.debounce)((function(t){y=trim(t).toLowerCase(),f()}),200);var v={},P={};addEvent(c,"click",t=>{var e=Object(o.domClosest)("_ape_pl_item",t.target),i=Object(o.domData)(e,"id");Object(o.toggleClass)(e,"ape_selected")?(P[i]=!0,delete v[i]):(v[i]=!0,delete P[i])}),r.removeButtons(),r.addButton(Object(u.getLang)("global_save"),t=>{var s=Object.keys(P),o=Object.keys(v);ajax.post("al_audio.php",{act:"save_audio_in_playlists",add_pl_ids:s.join(","),remove_pl_ids:o.join(","),owner_id:e,audio_owner_id:i,audio_id:a,hash:l},{showProgress:n.lockButton.pbind(t),hideProgress:n.unlockButton.pbind(t),onDone:()=>{r.hide()},onFail:()=>(r.hide(),!0)})},"ok",!0),r.addButton(Object(u.getLang)("global_cancel"),r.hide.bind(this),"no",!0)},showRecoms:function(t,e){cur.audioPage&&cur.audioPage.showRecoms(!1,e.fullId)},shareAudio:function(t,e){if(cur.viewAsBox)return cur.viewAsBox();if(e=e||getAudioPlayer().getCurrentAudio()){e=AudioUtils.asObject(e);var i=AudioUtils.isPodcast(e)?"podcast":"audio";return Object(d.onAdditionalEvent)(t,e,{type:r.TYPE_SHARE_AUDIO}),!showBox("like.php",{act:"publish_box",object:i+e.fullId,list:e.actionHash,to:"mail"},{stat:["page.js","page.css","wide_dd.js","wide_dd.css",jsc("web/sharebox.js")],onFail:function(t){return showDoneBox(t),!0}})}},showAudioAlbum:function(t,e){return cur.viewAsBox?cur.viewAsBox():(e=AudioUtils.asObject(e),layers.fullhide&&layers.fullhide(),Object(d.onAdditionalEvent)(t,e,{type:r.TYPE_SHOW_ALBUM}),AudioUtils.showAudioPlaylist(e.album[0],e.album[1],e.album[2]))},openEpisode:function(t,e){e=AudioUtils.asObject(e),AudioUtils.isPodcast(e)&&showPodcast(t,e.fullId,null,"audio")},replaceWithOriginal:function(t,e,i){(e=e||getAudioPlayer().getCurrentAudio())&&(e=AudioUtils.asObject(e),ajax.post("al_audio.php",{act:"replace_with_original",hash:e.replaceHash,audio_id:e.fullId},{onDone:function(a){var s=JSON.parse(e.extra).claim.original;s[AudioUtils.AUDIO_ITEM_INDEX_ID]=a,s[AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]=e.ownerId;var l=Object(o.se)(AudioUtils.drawAudio(s));t.parentElement.insertBefore(l,t),t.parentElement.removeChild(t),i&&i()},onFail:()=>(i(),!0)}))},editAudio:function(t,e,i){showBox("al_audio.php",{act:"edit_audio_box",aid:e.fullId,force_edit_hash:i},{params:{width:"456px",bodyStyle:"padding: 20px; background-color: #F7F7F7;",hideButtons:1},dark:1})},editEpisode:function(t,e){AudioUtils.isPodcast(e)&&(cur.podcastEditData={audioId:e.fullId},stManager.add([jsc("web/podcast.js")],(function(){Podcast.edit(e.fullId)})))},deleteCurrentAudio:function(t,e){window.tooltips&&"function"==typeof window.tooltips.hideAll&&window.tooltips.hideAll(t);var i=getAudioPlayer().getCurrentPlaylist();i&&i.removeAudio(e.fullId),Object(o.re)(t)},deleteRecomsAudio:function(t,e){AudioUtils.deleteAudio(t,e,!1,!0)},deleteListenedAudio:function(t,e){AudioUtils.deleteAudio(t,e,!1,!1,!0)},deleteAudio:function(t,e,i,a,s){function l(e){return Object(o.domData)(t,"in-progress",Object(c.intval)(e))}if(window.tooltips&&tooltips.hideAll(),!Object(c.intval)(Object(o.domData)(t,"in-progress"))){l(!0);var _=!1;e.isClaimed&&(_=!0);var g=q.getAddRestoreInfo(),A=g[e.fullId];if(A&&A.deleteAll)Object(h.showFastBox)({title:Object(u.getLang)("audio_delete_all_title"),dark:1,onHide:()=>l(!1)},A.deleteConfirmMsg||"",Object(u.getLang)("global_delete"),(function(t){var e=extend({act:"delete_all"},A.deleteAll);ajax.post("al_audio.php",e,{showProgress:n.lockButton.pbind(t),onDone:function(){var t=getAudioPlayer().getPlaylist(AudioPlaylist.TYPE_PLAYLIST,A.deleteAll.from_id,AudioPlaylist.DEFAULT_PLAYLIST_ID);getAudioPlayer().deletePlaylist(t),nav.reload()},onFail:()=>!0})}),Object(u.getLang)("global_cancel"));else{if(_?Object(o.re)(t):Object(o.addClass)(t,"audio_row__deleted"),s){ajax.post("al_audio.php",{act:"remove_listened",audio_id:e.id,audio_owner_id:e.ownerId,hash:e.actionHash},{onFail:()=>!0}),Object(o.re)(t);var y=getAudioPlayer().getCurrentPlaylist();y&&y.getType()==AudioPlaylist.TYPE_RECOM&&y.getAlbumId()==q.AUDIO_RECOMS_TYPE_LISTENED&&y.removeAudio(e.fullId)}else if(a){var f=q.getAudioExtra(e).recom,v=null,P=Object(p.getContextPlaylist)(t);P&&(v=P.playlist&&P.playlist.getAlbumId());var b={act:"hide_recommendation",hash:f.hash,audio_id:e.fullId,playlist_id:v};nav.objLoc.audio_id&&(b.recommendation_type="query"),ajax.post("al_audio.php",b,{onDone:()=>{Object(d.onAdditionalEvent)(t,e,{type:r.TYPE_RECOMMENDATION_REMOVED}),l(!1)},onFail:()=>(l(!1),!0)}),g[e.fullId]={state:"recom_hidden"};var m=getAudioPlayer().getCurrentPlaylist();m&&m.getType()==AudioPlaylist.TYPE_RECOM&&(g[e.fullId].removedCurrentPos=m.removeAudio(e))}else ajax.post("al_audio.php",{act:"delete_audio",oid:e.ownerId,aid:e.id,hash:e.deleteHash,restore:1,track_code:e.trackCode},{onDone:(i,a)=>{Object(d.onAdditionalEvent)(t,e,{type:r.TYPE_REMOVED}),_||l(!1),g[e.fullId]={state:"deleted",deleteAll:i,deleteConfirmMsg:a},_&&q.deleteDeletedAudios(),q.onRowOver(t,!1,!0)},onFail:()=>!0});q.onRowOver(t,!1,!0)}}},deleteEpisode:function(t,e){AudioUtils.isPodcast(e)&&stManager.add([jsc("web/podcast.js")],(function(){Podcast.deleteEpisode(e.fullId,e.deleteHash)}))},restoreEpisode:function(t,e){AudioUtils.isPodcast(e)&&stManager.add([jsc("web/podcast.js")],(function(){Podcast.restoreEpisode(e.fullId,e.editHash)}))},deleteDeletedAudios:function(){each(AudioUtils._audioAddRestoreInfo||{},(t,e)=>{"deleted"!=e.state&&"recom_hidden"!=e.state||getAudioPlayer().deleteAudioFromAllPlaylists(t)})},faveEpisode:function(t,e){if(AudioUtils.isPodcast(e)){var i=AudioUtils.getAudioExtra(e).faveHash;bookmarkPodcast(Object(o.geByClass1)("audio_row__action_fave",t),e.fullId,i)}},contextSplit:g.contextSplit,showAudioPlaylist:function(t,e,i,a,s,l){if(cur.apLayer)return cancelEvent(s);if(vk.widget)return!0;if(!s||!(s.metaKey&&browser.mac||s.ctrlKey)){var r=null;return window.Photoview&&window.cur&&cur.pvShown&&(r=clone(nav.objLoc),Photoview.hide(!0)),boxRefreshCoords(boxLoader),Object(o.show)(boxLoader),Object(o.show)(boxLayerWrap),stManager.add([jsc("web/auto_list.js"),"audio.css"],(function(){var s,d;function n(t){boxQueue.hideAll(),cur.apLayerAutoList&&(cur.apLayerAutoList.destroy(),cur.apLayerAutoList=null),layers.wraphide(window.audioPlaylistLayerWrap),layers.fullhide=!1,s&&removeEvent(window.audioPlaylistLayerWrap,"click",s),d&&removeEvent(bodyNode,"keydown",d),delete cur.apLayer,delete cur.apLayerPlaylistId,Object(o.removeClass)(layerBG,"ap_layer_bg_dark"),r?nav.change(r):nav.change({z:!1}),layerQueue.pop()}new AudioPlaylist({type:AudioPlaylist.TYPE_PLAYLIST,ownerId:t,albumId:e,hasMore:!0,accessHash:i,fromId:cur.oid,context:a}).loadAll((function(u,_){if(Object(o.hide)(boxLoader),Object(o.hide)(boxLayerWrap),_){var c=getLang("audio_error_deleted_playlist_box").split("/");return new MessageBox({title:c[0]}).content(c[1]).setButtons(getLang("global_close"),(function(){curBox().hide(),r&&nav.change(r)})).show(),void nav.setLoc(extend(nav.objLoc,{z:!1}))}var h=extend(nav.objLoc,{z:"audio_playlist"+t+"_"+e+(i?"/"+i:"")});nav.setLoc(h),window.audioPlaylistLayerWrap||(window.audioPlaylistLayerWrap=Object(o.se)('<div class="ap_layer_wrap"></div>'),bodyNode.appendChild(window.audioPlaylistLayerWrap));window.audioPlaylistLayerWrap.innerHTML="";var p=u.getAudiosList().length,g=u.isBlocked&&u.isBlocked(),y=f(u.getOwnerId(),u.getPlaylistId(),u.getAccessHash()),v=getTemplate("audio_playlist_snippet",{title:u.getTitle(),subTitle:u.getSubtitle(),description:u.getDescription(),coverStyle:u.getCoverUrl()?"background-image:url('"+u.getCoverUrl()+"'); background-size: cover;":"",authorLine:u.getAuthorLine(),infoLine1:u.getInfoLine1(),infoLine2:u.getInfoLine2(),id:u.getPlaylistId(),ownerId:u.getOwnerId(),href:y,addCls:u.getAddClasses(),followHash:u.getFollowHash(),accessHash:u.getAccessHash(),editHash:u.getEditHash(),deleteHash:u.getDeleteHash(),replaceHash:u.getReplaceHash(),gridCovers:u.getGridCovers(),type:u.getType(),context:a,followButtonText:u.isFollowed()?getLang("audio_playlist_btn_added"):getLang("audio_playlist_btn_add")});if(cur.apLayer=Object(o.se)(`\n        <div class="ap_layer">\n          <div class="ap_layer__content">\n            ${v}\n          </div>\n          <div class="ap_layer__close _ap_layer__close"></div>\n        </div>\n      `),g){Object(o.geByClass1)("audio_pl_snippet__body",cur.apLayer).innerHTML=getTemplate("playlist_snippet_stub")}window.audioPlaylistLayerWrap.appendChild(cur.apLayer),addEvent(window.audioPlaylistLayerWrap,"click",s=function(t){t.target!=window.audioPlaylistLayerWrap&&t.target!=Object(o.geByClass1)("_ap_layer__close",cur.apLayer)||layers.fullhide()}),addEvent(bodyNode,"keydown",d=function(t){if(27==t.keyCode)return layers.fullhide(),cancelEvent(t)}),layerQueue.push(),layerQueue.hide(),boxQueue.hideAll(),layers.wrapshow(window.audioPlaylistLayerWrap,.7),Object(o.addClass)(layerBG,"ap_layer_bg_dark");var P=Object(o.geByClass1)("_audio_pl_snippet__list",cur.apLayer),b=AudioUtils.getAlbumParts(u),m=0;p&&!g&&(cur.apLayerAutoList=new A.default(P,{scrollNode:window.audioPlaylistLayerWrap,onNeedRows:function(t,e){for(var i=[],a=u.getUnshuffledAudiosList(),s=e-=m;s<e+30;s++){var o=a[s];if(!o)break;if(b&&b.length&&b[0].offset===s){var l=b.shift();m++,i.push(AudioUtils.drawAlbumPartRow(l.number))}i.push(AudioUtils.drawAudio(o))}t(i)}}));boxRefreshCoords(cur.apLayer),getAudioPlayer().updateCurrentPlaying(),layers.fullhide=n,cur.apLayerPlaylistId=[t,e],l&&l()}))})),!1}},editPlaylist:P.editPlaylist,followPlaylist:function(t,e,i,a){var s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(vk&&vk.widget&&!vk.id&&window.Widgets)return Widgets.oauth(),!1;function l(a){var s=Object(o.domData)(t,"text-followed"),l=Object(o.domData)(t,"text-follow"),r=a?s:l;Object(o.domData)(t,"tooltip-text",r),(geByClass1("audio_pl_snippet__action_btn_add_text",t)||t).innerHTML=r,u.setFollowed(a);var d=u.getAddClasses()||"";d=d.replace("audio_pl__followed",""),a&&(d+=" audio_pl__followed"),u.mergeWith({addClasses:d}),each(Object(o.geByClass)(`_audio_pl_${e}_${i}`),(e,i)=>{Object(o.toggleClass)(i,"audio_pl__followed",a);var s=i.querySelectorAll(".audio_pl_snippet__action_btn_add")[0];s&&(s.innerHTML=t.innerHTML)})}function r(t){if(cur.audioPage&&cur.audioPage._data.playlists&&cur.audioPage.getOwnerId()===vk.id){if(t){var a=null;b=b.filter(t=>{var s=t.playlistId===i&&t.playlistOwnerId===e;return s&&(a=t.pl),!s}),a&&cur.audioPage._data.playlists.unshift(a)}else cur.audioPage._data.playlists=cur.audioPage._data.playlists.filter(t=>{var a=t.id===i&&t.owner_id===e;return a&&b.push({playlistId:i,playlistOwnerId:e,pl:t}),!a});cur.audioPage.updatePlaylistsCounter(vk.id)}}var d=Object(o.gpeByClass)("_audio_pl",t),n=Object(o.toggleClass)(d,"audio_pl__followed"),u=getAudioPlayer().getPlaylist(AudioPlaylist.TYPE_PLAYLIST,e,i);l(n),r(n),ajax.post("al_audio.php",{act:"follow_playlist",playlist_owner_id:e,playlist_id:i,hash:a,showcase:s},{onDone(t){m(t,n)},onFail:t=>(new MessageBox({title:getLang("global_error")}).content(t).setButtons(getLang("audio_ok"),(function(){curBox().hide()})).show(),l(!1),r(!1),!0)})},getLayer:function(){var t=window.audioLayer;return t||(window.audioLayer=t=new AudioLayer),t},updateQueueReceivedPost:function(t){t&&each(Object(o.geByClass)("_audio_row",t),(function(){Object(o.domData)(this,"new-post","groups"==cur.module?"wall":"feed")}))},toggleAudioHQBodyClass:function(){var t=AudioPlayer.showHQLabel();Object(o.toggleClass)(document.body,AudioUtils.AUDIO_HQ_LABEL_CLS,t)},hasAudioHQBodyClass:function(){return Object(o.hasClass)(document.body,AudioUtils.AUDIO_HQ_LABEL_CLS)},getAddRestoreInfo:function(){return AudioUtils._audioAddRestoreInfo=AudioUtils._audioAddRestoreInfo||{},AudioUtils._audioAddRestoreInfo},addAudio:function(t,e,i){if(cur.viewAsBox)return cur.viewAsBox();if(vk&&vk.widget&&!vk.id&&window.Widgets)return Widgets.oauth(),!1;function a(e){return Object(o.domData)(t,"in-progress",Object(c.intval)(e))}if(!Object(c.intval)(Object(o.domData)(t,"in-progress"))){a(!0),e||(e=AudioUtils.getAudioFromEl(t,!0));var s=window.AudioPage&&currentAudioPage(t),l=s&&s.getOwnerId()<0&&s.canAddToGroup()&&s.getOwnerId()!==e.ownerId?-s.getOwnerId():0,n=AudioUtils.getAddRestoreInfo(),u=n[e.fullId],_=Object(o.geByClass1)("_audio_row_"+e.fullId);_=_!=t&&_;var h=s&&s.getPageCurrentPlaylist(),g=Object(p.getContextPlaylist)(t,!0),A={group_id:l,audio_owner_id:e.ownerId,audio_id:e.id,hash:e.addHash,from:g&&g.context||"",track_code:e.trackCode};u?"recom_hidden"==u.state?(s&&(s.restoreRecommendation(t),a(!1)),AudioUtils.onRowOver(t,!1,!0)):"deleted"==u.state?(ajax.post("al_audio.php",{act:"restore_audio",oid:e.ownerId,aid:e.id,hash:e.restoreHash,track_code:e.trackCode},{onDone:function(){Object(d.onAdditionalEvent)(t,e,{type:r.TYPE_ADDED}),a(!1)},onFail:()=>(a(!1),!0)}),Object(o.removeClass)(t,"audio_row__deleted"),delete n[e.fullId],AudioUtils.onRowOver(t,!1,!0)):"added"==u.state&&(ajax.post("al_audio.php",{act:"delete_audio",oid:u.audio.ownerId,aid:u.audio.id,hash:u.audio.deleteHash,track_code:e.trackCode},{onDone:function(){Object(d.onAdditionalEvent)(t,e,{type:r.TYPE_REMOVED});var i=window.getAudioPlayer&&window.getAudioPlayer();i&&i.getPlaylist(AudioPlaylist.TYPE_PLAYLIST,l?-l:vk.id,AudioPlaylist.DEFAULT_PLAYLIST_ID).removeAudio(u.addedFullId),a(!1)},onFail:()=>(a(!1),!0)}),Object(o.removeClass)(t,"audio_row__added"),_&&Object(o.removeClass)(_,"audio_row__added"),delete n[e.fullId],getAudioPlayer().notify(E.events.REMOVED,e.fullId,u.addedFullId)):(ajax.post("al_audio.php?act=add",A,{onDone:function(o){if(Object(d.onAdditionalEvent)(t,e,{type:r.TYPE_ADDED}),o){var l=o[AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+o[AudioUtils.AUDIO_ITEM_INDEX_ID];if(n[e.fullId]={state:"added",addedFullId:l,audio:AudioUtils.asObject(o)},s)"all"!==s.getCurrentSection()?s.resetSection("all"):(s.sectionController.reloadBlock("my_audios"),s.sectionController.reloadBlock("group_audios"));Object(O.isFunction)(i)&&i()}a(!1)},onFail:function(e){return e&&new MessageBox({title:getLang("global_error")}).content(e).setButtons(getLang("global_close"),()=>curBox().hide()).show(),Object(o.removeClass)(t,"audio_row__added"),a(!1),!0}}),Object(o.addClass)(t,"audio_row__added"),_&&Object(o.addClass)(_,"audio_row__added"),getAudioPlayer().notify(E.events.ADDED,e.fullId),s&&h&&s.onUserAction(e,h))}},addAudioToOwner:function(t,e){return window.onAudioPageLoaded=function(){return this.uploadAudio({})},nav.go("audios"+t),cancelEvent(e)},chooseAudioBox:function(t,e,i){if(void 0!==t.selected)cur.lastAddMedia.unchooseMedia(t.selected),t.selected=void 0,Object(o.removeClass)(Object(o.domPN)(t),"audio_selected"),t.innerHTML=e.labels.add;else{var a=cur.attachCount&&cur.attachCount()||0;cur.chooseMedia("audio",e.owner_id+"_"+e.id,e.info),(!cur.attachCount||cur.attachCount()>a)&&cur.lastAddMedia&&(t.selected=cur.lastAddMedia.chosenMedias.length-1,Object(o.addClass)(Object(o.domPN)(t),"audio_selected"),t.innerHTML=e.labels.cancel)}return Object(v.cancelEvent)(i)},getAudioArtistsString:I.getAudioArtistsString,getAudioPerformers:w.getAudioPerformers,drawAudio:U,isClaimedAudio:function(t){return!!t&&(t=AudioUtils.asObject(t)).flags&AudioUtils.AUDIO_ITEM_CLAIMED_BIT},getDurationMod:C,getAudioExtra:function(t){return"object"==typeof(t=AudioUtils.asObject(t)).extra?t.extra:JSON.parse(t.extra||"{}")},getAudioFromEl:function(t,e){t=Object(o.domClosest)("_audio_row",t);var i=Object(o.data)(t,"audio")||JSON.parse(Object(o.domData)(t,"audio"));if(!i)return null;if(e){(i=AudioUtils.asObject(i)).isDeleted=Object(o.hasClass)(t,"audio_row__deleted"),i.isCurrent=Object(o.hasClass)(t,AudioUtils.AUDIO_CURRENT_CLS),i.isPlaying=Object(o.hasClass)(t,AudioUtils.AUDIO_PLAYING_CLS),i.isFromCurrentPlaylist=!!Object(o.gpeByClass)("_audio_section__current",t),i.isNumeric=!!Object(o.gpeByClass)("audio_numeric",t),i.isWithCovers=!!Object(o.gpeByClass)("audio_w_covers",t),i.withInlinePlayer=!i.isWithCovers&&!Object(o.gpeByClass)("audio_no_inline_player",t),i.isInSnippet=!!Object(o.gpeByClass)("_audio_pl_snippet__list",t),i.isInEditBox=!!Object(o.gpeByClass)("_audio_pl_edit_box",t),i.isInRecomsBlock=!!Object(o.gpeByClass)("_audio_recoms_blocks",t),i.isInFastChat=!!Object(o.gpeByClass)("fc_tab",t),i.isInAttach=!!Object(o.gpeByClass)("media_preview",t),i.isSetClaimed=Object(o.hasClass)(t,"audio_moder_claimed"),i.isPodcastListSnippet=Object(o.hasClass)(t,"podcast_list_snippet");var a=Object(o.gpeByClass)("_audio_pl",t);i.isCurrentAlbumSnippet=!!i.album&&!!a&&a.dataset.playlistId===`playlist_${i.album[0]}_${i.album[1]}`}return i},getAudioFullId:T.getAudioFullId,asObject:L.asObject,initDomPlaylist:function(t,e){var i=[];return each(e,(function(t,e){e&&each(Object(o.geByClass)("_audio_row",e),(function(t){i.push(AudioUtils.getAudioFromEl(this))}))})),t.addAudio(i),t},getContextPlaylist:p.getContextPlaylist,renderAudioDiag:function(){var t=Object(o.ge)("audio_diag_log"),e=ls.get(AudioUtils.LOG_LS_KEY)||[];t&&each(e,(function(e,i){var a=new Date(i.shift()).toUTCString();i=i.join(", "),t.appendChild(Object(o.se)('<div class="audio_diag_log_row"><span class="audio_diag_log_time">'+a+"</span>"+i+"</div>"))}))},claim:function(t,e,i){Object(o.addClass)(e,"audio_moder_claimed"),AudioUtils.onRowOver(e,!1,!0),t=AudioUtils.asObject(t),ajax.post("al_claims.php",{act:"a_claim",claim:i,type:"audio",id:t.id,owner_id:t.ownerId})},unclaim:function(t,e,i){Object(o.removeClass)(e,"audio_moder_claimed"),AudioUtils.onRowOver(e,!1,!0),t=AudioUtils.asObject(t),ajax.post("al_claims.php",{act:"a_unclaim",claim:i,type:"audio",id:t.id,owner_id:t.ownerId,hash:t.actionHash})},getUMAInfo:function(t,e){e.isInEditBox||showBox("al_audio.php",{act:"get_uma_restrictions",id:e.id,owner_id:e.owner_id,hash:e.actionHash},{params:{width:1e3}})},getUMAInfoAlbum:function(t,e){e.isInEditBox||showBox("al_audio.php",{act:"get_uma_restrictions_album",playlist_raw_id:t},{params:{width:750}})},cancelReplacement:function(t,e,i){ajax.post("al_audio.php",{act:"cancel_replacement",hash:e,audio_id:t},{onFail:()=>!0}),Object(o.re)(i)},removeFromGroup:S.removeFromGroup,addToGroupBox:D.addToGroupBox,showAudioRestriction:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t)return!1;if((t=Object(L.asObject)(t)).restrictionStatus){if(t.actionHash){Object(Y.statlogsValueEvent)("audio_restriction_popup","show",t.restrictionStatus);var i=showBox("al_audio.php",{act:"restriction_box",audio_id:t.id,owner_id:t.owner_id,hash:t.actionHash},{params:{hideButtons:!0,onShow:function(){var i=curBox();Object(O.isFunction)(e.onShow)&&e.onShow(),i&&i.once("click:ok",()=>{Object(Y.statlogsValueEvent)("audio_restriction_popup","click",t.restrictionStatus)})},onHide:i=>{Object(O.isFunction)(e.onHide)&&e.onHide(),i||Object(Y.statlogsValueEvent)("audio_restriction_popup","hide",t.restrictionStatus)}},containerClass:"audio_restriction_box audio_restriction_box_type_"+t.restrictionStatus,onDone:(e,i)=>{if(i&&i.play){e.hide();var a=X(i.audio?Object(L.asObject)(i.audio):t),s=Object(W.getAudioPlayer)();a&&s.toggleAudio(a,{target:a})}},onFail:()=>(i&&i.hide(),K(t),!0)})}else K(t);return!0}return!1},isPodcast:j.isPodcast,isPrivatePodcast:function(t){return!(!AudioUtils.isPodcast(t)||!AudioUtils.getAudioExtra(t).private)},followArtist:function(t,e,i,a){Object(n.lockButton)(a),ajax.post("al_artist.php",{act:"follow",artist_id:t,ref:e,hash:i},{onFail:()=>Object(n.unlockButton)(a),onDone:i=>{Object(n.unlockButton)(a),Object(o.geByClass1)("audio_artist__follow_icon",a).classList.add("audio_artist__follow_icon__followed"),a.classList.add("audio_artist__follow_btn__followed"),a.onclick=s=>{s.preventDefault(),AudioUtils.unfollowArtist(t,e,i,a)}}})},unfollowArtist:function(t,e,i,a){Object(n.lockButton)(a),ajax.post("al_artist.php",{act:"unfollow",artist_id:t,ref:e,hash:i},{onFail:()=>Object(n.unlockButton)(a),onDone:i=>{Object(n.unlockButton)(a),Object(o.geByClass1)("audio_artist__follow_icon",a).classList.remove("audio_artist__follow_icon__followed"),Object(o.hasClass)(a,"audio_artist__follow_btn__can_follow")?(a.classList.remove("audio_artist__follow_btn__followed"),a.onclick=s=>{s.preventDefault(),AudioUtils.followArtist(t,e,i,a)}):re(a)}})},trackArtistToOfficial:function(t,e){ajax.post("al_artist.php",{act:"track_to_official",hash:t,url:e},{onFail:()=>!0})},PodcastsLogs:a,copyPlaylistLink:function(t,e,i){statlogsValueEvent("audio_copy_link",vk.id),Object(H.copyToClipboard)(f(t,e,i,!0)),showDoneBox(getLang("audio_playlist_link_copied"))},getAlbumParts:function(t){if(t&&t.getAudiosCount()&&t.isFullyLoadable()&&!t.hasMore()){for(var e=t.getAudiosList(),i=t.getAudiosCount(),a=[],o=0,l=0;l<i;l++){var r=e[l][s.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ALBUM_PART];r>o&&(o=r,a.push({number:r,offset:l}))}if(a.length>1)return a}return!1},drawAlbumPartRow:function(t){return`<div class="audio_album_part_row">${getLang("audio_album_part").replace("{part}",t)}</div>`},onRowOver:l.onRowOver,onRowLeave:function(t){Object(o.data)(t,"leaved",!0);var e=Object(o.data)(t,"tt");if((!e||!e.isShown())&&(clearTimeout(window.audioRowHoverTO),Object(o.data)(t,"actions"))){var i=Object(o.geByClass1)("_audio_row__actions",t),a=Object(o.geByClass1)("_audio_row__duration",t);re(i),Object(o.setStyle)(a,"visibility","visible"),Object(o.data)(t,"actions",0)}},onAudioAddedToPlaylist:function(t,e,i,a){getAudioPlayer().getPlaylist(AudioPlaylist.TYPE_PLAYLIST,t,e).addAudio(a,0),each(Object(o.geByClass)(`_audio_pl_${t}_${e}`),(t,e)=>{domReplaceEl(e,Object(o.se)(i))})},onAudioChoose:function(t,e,i,a){if(Object(c.isUndefined)(e.selected)){var s=cur.attachCount&&cur.attachCount()||0,l=i.fullId+(i.accessKey?"_"+i.accessKey:"");if(cur.chooseMedia("audio",l,a),(!cur.attachCount||cur.attachCount()>s)&&cur.lastAddMedia){e.selected=cur.lastAddMedia.chosenMedias.length-1,Object(o.addClass)(Object(o.domPN)(e),"audio_selected");var r=Object(o.getSize)(e)[0];Object(o.setStyle)(e,"width",r),e.innerHTML=getLang("global_cancel")}}else cur.lastAddMedia.unchooseMedia(e.selected),e.selected=void 0,Object(o.removeClass)(Object(o.domPN)(e),"audio_selected"),e.innerHTML=getLang("global_add_media");return Object(v.cancelEvent)(t)},onPlaylistChoose:function(t,e){var i=e.getAccessHash();cur.chooseMedia("audio_playlist",e.getOwnerId()+"_"+e.getPlaylistId()+(i?":"+i:""),{id:e.getPlaylistId(),ownerId:e.getOwnerId(),coverUrl:e.getCoverUrl(),gridCovers:e.getGridCovers(),title:e.getTitle(),authorName:e.getAuthorName(),authorHref:e.getAuthorHref(),accessHash:e.getAccessHash()})},claimPlaylist:function(t,e,i){var a=nav.objLoc.claim;if(a){var s={act:i?"a_unclaim_playlist":"a_claim_playlist",claim:a,type:"audio",owner_id:t,playlist_id:e};ajax.post("al_claims.php",s,{onDone:t=>{showDoneBox(t)}})}},initUpload:function(t,e,i,a,s,o,l,r,d,n,u,_){cur.loadAudioDone=function(e,i){if(cur.audioPage){if(cur.boxClose&&cur.audioPage.onAudioAllUploaded(),cur.audioPage.onAudioUploaded(e,i),cur.boxClose){delete cur.boxClose;var a=cur.audiosLoaded>1?getLang("audio_success_msg_multiple"):getLang("audio_success_msg");t.setOptions({title:getLang("audio_uploading_over"),bodyStyle:"padding: 16px 23px;"}),t.content(a),hide(t.progress),setTimeout((function(){t.hide(200)}),2e3),delete cur.audiosLoaded,_tbLink&&_tbLink.loc&&(cur.__phinputs=cur.__phinputs||[],globalHistoryDestroy(_tbLink.loc))}}else cur.boxClose&&nav.go("/audios"+i[AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID],!1,{onDone:function(){cur.__phinputs=cur.__phinputs||[],globalHistoryDestroy(nav.objLoc[0])}})},cur.loadAudioFailed=function(i,a){hide(t.progress),Upload.embed(i);var s=ge("audio_new_error"),o=s&&domFC(s),l=a.split("|");o&&(a=l[0],l=l[1],o.innerHTML=l||(e[a]||getLang("audio_loading_error").replace("{code}",intval(a))),show(s))},Upload.init("audio_add_upload_btn",i,a,{file_name:"file",file_size_limit:s,file_types_description:"Audio files (*.mp3)",file_types:"*.mp3;*.MP3",accept:"audio/mpeg",lang:o,onUploadStart:function(e,i){"form"===Upload.types[e]&&show(t.progress),"form"!==Upload.types[e]&&"fileApi"!==Upload.types[e]||(geByClass1("file",ge("audio_add_upload_btn")).disabled=!0),curBox().changed=!0},onUploadProgress:function(t,e,i){if(!ge("form"+t+"_progress")){for(var a=Upload.obj[t],s=getSize(a)[1]/2+10,o=a.firstChild;o;)1===o.nodeType&&(o.id==="uploader"+t&&browser.msie?setStyle(o,{position:"relative",left:"-5000px"}):setStyle(o,{visibility:"hidden"})),o=o.nextSibling;a.appendChild(ce("div",{innerHTML:'<div class="audio_progress_wrap"><div id="form'+t+'_progress" class="audio_progress" style="width: 0%;"></div></div></div>'},{height:s+"px",marginTop:-s+"px"}))}var l=intval(e/i*100);setStyle(ge("form"+t+"_progress"),{width:l+"%"})},onUploadComplete:function(t,e){var i;e=e.replace(/\+/g," ");try{i=JSON.parse(e)}catch(t){i=AjaxConvert.fromQueryString(e)}var a={};this.use_go_uploader?a={act:"done_add",upldr:1,go_uploader_response:e}:(i.title=decodeURIComponent(i.title),i.artist=decodeURIComponent(i.artist),a=V({},i,{},{act:"done_add",upldr:1})),i.code?cur.loadAudioFailed(t,i.code):ajax.post("al_audio.php",a,{onDone:function(e){cur.loadAudioDone(t,e)},onFail:function(e){return cur.loadAudioFailed(t,e),!0}})},onUploadCompleteAll:function(t,e){cur.boxClose=!0},onUploadError:cur.loadAudioFailed,clear:1,multiple:1,force_max_files:!0,max_files:l,max_files_hide_last:1,type:"audio",max_attempts:3,reverse_files:1,server:r,error:d,error_hash:n,dropbox:"choose_audio_dropbox",use_go_uploader:_}),t.setControlsText(u)},_showPlaylistsChooser:function(t,e,i,a,s,l){var n=i.playlists,u=i.newPlaylistHash,_=i.morePlaylists;AudioUtils.copiedToPlaylistAudios=AudioUtils.copiedToPlaylistAudios||{},AudioUtils.copiedToPlaylistAudiosHashes=AudioUtils.copiedToPlaylistAudiosHashes||{};var c=e,h=Object(o.se)(Object(o.rs)(AudioUtils.AUDIO_ROW_ACTION_ROW_ITEM,["pl_new",0,getLang("audio_add_to_new_pl"),"audio_row__action_playlist"]));if(domInsertAfter(h,c),c=h,h.addEventListener("click",()=>{AudioUtils.editPlaylist(a,!1,"edit",{addAudio:l,newPlaylistHash:u})}),each(n,(t,e)=>{var i=!0,a=e[0]+"_"+e[1]+"_"+s.fullId,l=AudioUtils.copiedToPlaylistAudios[a],n="audio_row__action_playlist";(e[3]||l)&&(i=!1,n+=" audio_row__more_playlist_added");var u=Object(o.se)(Object(o.rs)(AudioUtils.AUDIO_ROW_ACTION_ROW_ITEM,["pl_"+e[0]+"_"+e[1],0,e[2],n]));domInsertAfter(u,c),c=u;var _=!1;u.addEventListener("click",()=>{if(!_){_=!0;var t=s.ownerId,l=s.id,n=AudioUtils.copiedToPlaylistAudios[a];n&&(t=(n=n.split("_"))[0],l=n[1]),i&&(AudioUtils.copiedToPlaylistAudiosHashes[a]=e[4]),ajax.post("al_audio.php",{act:"add_audio_to_playlist",hash:e[4],playlist_id:e[1],playlist_owner_id:e[0],audio_owner_id:t,audio_id:l,do_add:intval(i)},{onDone:(t,o,l)=>{Object(d.onAdditionalEvent)(u,s,{type:i?r.TYPE_ADDED:r.TYPE_REMOVED,playlistId:e[0]+"_"+e[1]}),AudioUtils.copiedToPlaylistAudios[a]=!!i&&l,e[4]=i?t:AudioUtils.copiedToPlaylistAudiosHashes[a],i=!i,_=!1},onFail:()=>!0}),Object(o.toggleClass)(u,"audio_row__more_playlist_added",i)}})}),_){var p=Object(o.se)(Object(o.rs)(AudioUtils.AUDIO_ROW_ACTION_ROW_ITEM,["pl_more",0,getLang("audio_row_show_all_playlists"),"audio_row__action_playlist"]));p.addEventListener("click",()=>{showBox("al_audio.php?act=more_playlists_add",{owner_id:a,audio_owner_id:s.ownerId,audio_id:s.id},{params:{bodyStyle:"padding: 0px",width:560}})}),domInsertAfter(p,c),c=p}t.updatePosition()},debugLog:function(){}})},tWcy:function(t,e,i){"use strict";i.r(e),i.d(e,"getAudioFullId",(function(){return s}));var a=i("uk5P");function s(t){return t[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+t[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ID]}},wtP8:function(t,e,i){"use strict";i.r(e),i.d(e,"addToGroupBox",(function(){return s}));var a=i("zxIV");function s(t,e,i){var s=t+"_"+e,o=window.showBox("al_audio.php",{act:"add_to_groups_box",playlist_id:s,access_hash:i}).setButtons(getLang("Save"),()=>{var t=[];for(var e in cur.wdd.follow_playlist_wwd.selected)t.push(cur.wdd.follow_playlist_wwd.selected[e][0]);t.length&&(Object(a.ge)("add_playlist_to_group_fail").innerHTML="",ajax.post("al_audio.php",{act:"add_to_group",group_ids:t,hash:Object(a.ge)("add_playlist_to_group_hash").value,playlist_id:s},{onDone(t){o.hide(),showDoneBox(t)},onFail:t=>(Object(a.ge)("add_playlist_to_group_fail").innerHTML=t,!0)}))})}}}]);try{stManager.done("cmodules/bundles/audioplayer.3a983c70bcfc6a52636e.js")}catch(t){}