!function(a){var r={script$:a('script[src*="referrals.min.js"][data-vendor]').eq(0),getParam:function(a){var r=new RegExp("[\\?&]"+a.replace(/[\[]/g,"\\[").replace(/[\]]/g,"\\]")+"=([^&#]*)"),e=r.exec(location.search);return e&&e.length?decodeURIComponent(e[1].replace(/\+/g," ")):window.ReferWP.queryParams&&"string"==typeof window.ReferWP.queryParams[a]?window.ReferWP.queryParams[a]:""},getAffiliateID:function(){var a=r.script$.data("param"),e=a||"aff",i=String(r.getParam(e));return i||a||(i=String(r.getParam("affiliate"))),i},getCampaignID:function(){var a=r.script$.data("campaign-param")||r.script$.data("campaign-id-param")||"cid";return String(r.getParam(a))},getSubID:function(){var a=r.script$.data("subid-param")||r.script$.data("sub-id-param")||"sid";return String(r.getParam(a)).substr(0,255)},trackReferral:function(){if(r.script$.length){var e=String(r.script$.data("vendor")||"");if(e&&e.match(/^[0-9]+$/gi)){var i=r.script$.data("endpoint")||"https://refer.wordpress.com/clicks/";if(i&&(i+=e,affiliate_id=r.getAffiliateID(),affiliate_id&&/^[0-9]+$/.test(affiliate_id))){var t={affiliate_id:affiliate_id,referrer:window.location.href},n=r.getCampaignID();n.match(/^[0-9]+$/gi)&&(t.campaign_id=n);var d=r.getSubID();d.length&&(t.sub_id=d),a.ajax({type:"POST",url:i,data:t,dataType:"json",xhrFields:{withCredentials:!0},success:function(r){a(document).trigger("referral_tracked",r)},error:function(r){a(document).trigger("referral_tracked_error",r)}})}}}},addQueryArg:function(a,r,e){var i=e.indexOf("?")>=0?"&":"?",t=e.replace(/^[^#]+/gi,""),e=e.replace(/#[^#]*$/gi,"");return e+i+encodeURIComponent(a)+"="+encodeURIComponent(r)+t},updateLinks:function(e,i){i=i||{};var t=i.param||"aff",n=i.campaign_param||i.campaign_id_param||"cid",d=i.subid_param||i.sub_id_param||"sid",c=i.regex||"",g=i.callback||null,f=r.getAffiliateID();if(f){var p=r.getCampaignID(),o=r.getSubID();a(e).each(function(){var e=a(this);["href","action"].forEach(function(a){if(e.is("["+a+"]")){var i=e.attr(a);c&&!c.test(i)||"function"==typeof g&&!1===g(e,i)||(RegExp("[?&]"+t+"=","gi").test(i)||(i=r.addQueryArg(t,f,i)),p&&!RegExp("[?&]"+n+"=","gi").test(i)&&(i=r.addQueryArg(n,p,i)),o&&!RegExp("[?&]"+d+"=","gi").test(i)&&(i=r.addQueryArg(d,o,i)),e.attr(a,i))}})})}},linkDomains:function(a){Array.isArray(a)&&a.forEach(function(a){"object"==typeof a&&a?(a.param||"aff",a.campaign_param||a.campaign_id_param||"cid",a.subid_param||a.sub_id_param||"sid",a=a.domain||""):("aff","cid"),String(a).match(/[a-z0-9\.\-\/]+/gi)&&(r.updateLinks('[href*="'+a+'"]',{regex:new RegExp("^[^?]*"+a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi")}),r.updateLinks('[action*="'+a+'"]',{regex:new RegExp("^[^?]*"+a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi")}))})}};window.ReferWP=a.extend(window.ReferWP||{},{linkDomains:r.linkDomains,updateLinks:r.updateLinks,addQueryArg:r.addQueryArg}),a(document).ready(r.trackReferral)}(jQuery);